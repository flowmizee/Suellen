<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
    <title>Chat Hot com Suellen</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', sans-serif;
        height: 100%;
        background-color: #ece5dd;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #1e1e2e;
      }
      .chat-container {
        width: 100%;
        height: 100dvh;
        max-width: 430px;
        background-color: #2a2a3a;
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
        position: relative;
        color: #f0f0f0;
      }
      .chat-header {
        background-color: #6a1b9a;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        color: white;
        border-bottom: 1px solid #4a148c;
      }
      .chat-header img {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        margin-right: 12px;
        object-fit: cover;
        border: 2px solid #9c27b0;
      }
      .chat-header .name {
        font-size: 18px;
        font-weight: bold;
      }
      .chat-body {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #2a2a3a;
        display: flex;
        flex-direction: column;
      }
      .message {
        max-width: 75%;
        padding: 10px 14px;
        margin-bottom: 8px;
        font-size: 15px;
        border-radius: 8px;
        line-height: 1.4;
        word-wrap: break-word;
      }
      .user {
        align-self: flex-end;
        background-color: #6a1b9a;
        border-bottom-right-radius: 0;
      }
      .bot {
        align-self: flex-start;
        background-color: #4a148c;
        border-bottom-left-radius: 0;
      }
      .typing-indicator {
        align-self: flex-start;
        background-color: #4a148c;
        border-bottom-left-radius: 0;
        max-width: 50px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        margin-bottom: 8px;
        padding: 5px 10px;
      }
      .typing-indicator span {
        display: inline-block;
        width: 6px;
        height: 6px;
        margin: 0 1px;
        background-color: #f0f0f0;
        border-radius: 50%;
        animation: blink 1.4s infinite both;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes blink {
        0%, 80%, 100% { opacity: 0; }
        40% { opacity: 1; }
      }
      .chat-footer {
        display: flex;
        padding: 8px 10px;
        background-color: #2a2a3a;
        border-top: 1px solid #4a148c;
        align-items: center;
        position: relative;
      }
      .chat-footer input {
        flex: 1;
        padding: 12px;
        border: none;
        font-size: 16px;
        border-radius: 20px;
        margin-right: 8px;
        background-color: #3a3a4a;
        outline: none;
        padding-left: 15px;
        color: #f0f0f0;
      }
      .chat-footer button#actionButton {
        width: 40px;
        height: 40px;
        background-color: #9c27b0;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .chat-footer button#actionButton:hover {
        background-color: #ab47bc;
      }
      .chat-footer button#actionButton img {
        width: 20px;
        height: 20px;
      }
      .option-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }
      .option-button {
        background-color: #9c27b0;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
      }
      .option-button:hover {
        background-color: #ab47bc;
      }
      .preview-image {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
        border: 2px solid #9c27b0;
      }
      .upload-label {
        display: inline-flex;
        align-items: center;
        padding: 8px 12px;
        background-color: #9c27b0;
        color: white;
        border-radius: 20px;
        cursor: pointer;
        margin-top: 10px;
        margin-right: 10px;
        font-size: 14px;
        gap: 6px;
        transition: background-color 0.3s;
      }
      .upload-label:hover {
        background-color: #ab47bc;
      }
      .upload-label img {
        width: 16px;
        height: 16px;
      }
      #uploadImage, #uploadComprovanteFoto, #uploadComprovantePDF {
        display: none;
      }
      .pix-info {
        background-color: #3a3a4a;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
      }
      .pix-info p {
        margin: 5px 0;
      }
      .pix-info strong {
        color: #ab47bc;
      }
      .comprovante-container {
        margin-top: 15px;
      }
      .comprovante-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
        margin-top: 10px;
        border: 1px solid #9c27b0;
      }
      .success-message {
        color: #4caf50;
        font-weight: bold;
        margin-top: 10px;
      }
      .error-message {
        color: #f44336;
        font-weight: bold;
        margin-top: 10px;
      }
      .pdf-warning {
        background-color: #3a3a4a;
        color: #ff9800;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
        font-size: 14px;
      }
      .upload-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }
      .photo-package {
        margin-top: 15px;
        padding: 10px;
        background-color: #3a3a4a;
        border-radius: 8px;
        text-align: center;
      }
      .photo-package img {
        max-width: 100%;
        border-radius: 8px;
        margin: 5px 0;
      }
      .flirt-button {
        background-color: #e91e63;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
        margin-top: 10px;
      }
      .flirt-button:hover {
        background-color: #f06292;
      }
      .mic-icon {
        position: absolute;
        left: 15px;
        width: 24px;
        height: 24px;
        cursor: pointer;
        animation: pulse 1.5s infinite ease-in-out;
        display: none;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }
      .bot-recording-indicator {
        background-color: white;
        padding: 8px 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        align-self: flex-start;
        max-width: 40px;
        position: relative;
        box-shadow: 0 1px 1px rgba(0,0,0,0.1);
      }
      .bot-recording-indicator::after {
        content: '';
        position: absolute;
        left: -8px;
        top: 8px;
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-right: 8px solid white;
        border-bottom: 8px solid transparent;
      }
      .bot-recording-img {
        width: 32px;
        height: 32px;
        animation: pulse 1.5s infinite ease-in-out;
      }
      .user-recording-indicator {
        position: absolute;
        left: 35px;
        display: flex;
        align-items: center;
      }
      .user-recording-img {
        width: 24px;
        height: 24px;
        margin-right: 8px;
        animation: pulse 1.5s infinite ease-in-out;
      }
      .user-recording-time {
        font-size: 14px;
        color: #555;
        position: absolute;
        left: 45px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <img src="perfil.webp" alt="Perfil">
        <div class="name"><strong>Suellen Rocha</strong></div>
      </div>
      <div class="chat-body" id="chatBody"></div>
      <div class="chat-footer">
        <img src="gravaperson.webp" alt="Gravar" class="mic-icon" id="micIcon">
        <span class="user-recording-time" id="recordingTime" style="display: none;">0:00</span>
        <input type="text" id="userInput" placeholder="Digite sua mensagem..." oninput="updateActionIcon()" onkeypress="handleKeyPress(event)">
        <button id="actionButton" title="Gravar ou enviar">
          <img id="actionIcon" src="gravacao.webp" alt="√çcone">
        </button>
      </div>
    </div>

    <script>
      // Configura√ß√£o do PDF.js
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
      
      const PIX_KEY = '98981420070';
      const RECEIVER_NAME = 'Antonio Renimar Pinheiro Almeida';
      const RECEIVER_KEYWORDS = ['antonio', 'renimar', 'pinheiro', 'almeida'];
      const PHOTO_PRICE = 2;
      
      let isWaitingResponse = false;
      let typingEl = null;
      let typingTimeout = null;
      let currentPhotoIndex = 1;
      let isWaitingPayment = false;
      let comprovanteUploaded = false;
      let isWaitingImage = false;
      let pipeline = null;
      let recognition;
      let userName = null;
      const actionButton = document.getElementById('actionButton');
      const actionIcon = document.getElementById('actionIcon');
      const userInput = document.getElementById('userInput');
      const micIcon = document.getElementById('micIcon');
      const recordingTime = document.getElementById('recordingTime');
      let recordingStartTime = null;
      let recordingTimer = null;
      let activeAudio = null;
      let audioEndListener = null;
      let initialMessageSent = false;

      // Configura√ß√£o do reconhecimento de voz
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'pt-BR';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.onstart = () => {
          startRecordingUI();
          recordingStartTime = new Date();
          updateRecordingTime();
        };
        recognition.onend = () => {
          stopRecordingUI();
          if (recordingTimer) {
            clearInterval(recordingTimer);
            recordingTimer = null;
          }
        };
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          userInput.value = transcript;
          updateActionIcon();
          sendMessage();
        };
      }

      function startRecordingUI() {
        micIcon.style.display = 'block';
        recordingTime.style.display = 'block';
        userInput.placeholder = '';
      }

      function stopRecordingUI() {
        micIcon.style.display = 'none';
        recordingTime.style.display = 'none';
        userInput.placeholder = 'Digite sua mensagem...';
      }

      function updateRecordingTime() {
        recordingTimer = setInterval(() => {
          const now = new Date();
          const elapsed = Math.floor((now - recordingStartTime) / 1000);
          const minutes = Math.floor(elapsed / 60);
          const seconds = elapsed % 60;
          recordingTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
      }

      function updateActionIcon() {
        if (userInput.value.trim()) {
          actionIcon.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik0yLDExTDIyLDExTDEyLDIxTDEyLDMiLz48L3N2Zz4=';
        } else {
          actionIcon.src = 'gravacao.webp';
        }
      }

      actionButton.addEventListener('click', () => {
        if (userInput.value.trim()) {
          sendMessage();
        } else if (recognition) {
          try {
            recognition.start();
          } catch (e) {}
        }
      });

      // Inicializar o modelo de reconhecimento de imagem
      async function initializeImageRecognition() {
        try {
          pipeline = await transformers.pipeline(
            'image-to-text',
            'Xenova/vit-gpt2-image-captioning'
          );
          console.log("Modelo de reconhecimento de imagem carregado");
        } catch (error) {
          console.error("Erro ao carregar modelo de reconhecimento de imagem:", error);
        }
      }
      
      // Carregar o modelo quando a p√°gina carregar
      window.onload = async () => {
        await initializeImageRecognition();
        
        // Enviar mensagem inicial ap√≥s 5 segundos se o usu√°rio n√£o interagir
        setTimeout(() => {
          if (!initialMessageSent && document.getElementById('chatBody').children.length === 0) {
            simulateTyping("Oi√™, gato! Tudo bem com voc√™? ü•∞");
            initialMessageSent = true;
          }
        }, 5000);
      };

      async function analyzeImage(imageData) {
        try {
          if (!pipeline) {
            await initializeImageRecognition();
          }
          
          const output = await pipeline(imageData);
          return output[0].generated_text;
        } catch (error) {
          console.error("Erro ao analisar imagem:", error);
          return null;
        }
      }

      async function handleImageUpload(file) {
        const reader = new FileReader();
        reader.onload = async function(e) {
          const imageData = e.target.result;
          
          // Mostrar a imagem enviada pelo usu√°rio
          const previewHTML = `
            <div class="comprovante-container">
              <img src="${imageData}" class="comprovante-preview">
            </div>
          `;
          appendMessage("user", previewHTML);
          
          // Analisar a imagem
          showTypingIndicator();
          const imageDescription = await analyzeImage(imageData);
          hideTypingIndicator();
          
          if (imageDescription) {
            // Gerar resposta provocativa baseada na descri√ß√£o da imagem
            const responses = [
              `Adorei o que vejo... ${imageDescription.toLowerCase()} √© t√£o excitante, n√£o acha? üòè`,
              `Hmm, ${imageDescription.toLowerCase()}... Voc√™ sabe como deixar uma garota curiosa, hein? üòâ`,
              `Que interessante... ${imageDescription.toLowerCase()} me faz imaginar tantas possibilidades... üòà`,
              `Voc√™ tem bom gosto! ${imageDescription.toLowerCase()} √© algo que realmente me chama aten√ß√£o... üòò`,
              `Nossa, ${imageDescription.toLowerCase()}... Voc√™ est√° tentando me provocar? Porque est√° funcionando... üòä`
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            await simulateTyping(randomResponse);
            
            // Perguntar se quer ver fotos
            await simulateTyping("Quer ver umas fotos minhas bem especiais? S√£o R$ 2 por foto... Quantas voc√™ quer?");
            
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handlePhotoInterest('1 foto')">1 foto (R$ 2)</button>
                <button class="option-button" onclick="handlePhotoInterest('2 fotos')">2 fotos (R$ 4)</button>
                <button class="option-button" onclick="handlePhotoInterest('3 fotos')">3 fotos (R$ 6)</button>
                <button class="option-button" onclick="handlePhotoInterest('5 fotos')">5 fotos (R$ 10)</button>
              </div>
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Continuar conversando')">üí¨ Continuar conversando</button>
              </div>`);
          } else {
            await simulateTyping("Que imagem interessante... Mas sabe o que seria mais interessante? Ver umas fotos minhas bem especiais... Quer? S√£o R$ 2 por foto... Quantas voc√™ quer?");
            
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handlePhotoInterest('1 foto')">1 foto (R$ 2)</button>
                <button class="option-button" onclick="handlePhotoInterest('2 fotos')">2 fotos (R$ 4)</button>
                <button class="option-button" onclick="handlePhotoInterest('3 fotos')">3 fotos (R$ 6)</button>
                <button class="option-button" onclick="handlePhotoInterest('5 fotos')">5 fotos (R$ 10)</button>
              </div>
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Continuar conversando')">üí¨ Continuar conversando</button>
              </div>`);
          }
        };
        reader.readAsDataURL(file);
      }

      async function handlePhotoInterest(option) {
        appendMessage("user", option);
        
        // Extrair quantidade de fotos e calcular valor
        const quantity = parseInt(option);
        const totalPrice = quantity * PHOTO_PRICE;
        
        // Resposta envolvente para vender as fotos
        await simulateTyping(`Ah, meu amor, para eu te mandar essas ${quantity > 1 ? quantity + ' fotinhas' : 'fotinha'} que √†s vezes d√£o um trabalhinho, voc√™ precisa me passar pelo menos um pix de R$ ${totalPrice}, t√° bom? S√£o ${quantity} ${quantity > 1 ? 'fotos' : 'foto'} linda${quantity > 1 ? 's' : ''} s√≥ para voc√™... rsrs`);
        await simulateTyping(`Depois que voc√™ fizer o pix e me mandar o comprovante, eu te mando as fotos na hora! Prometo que vale a pena... üòò`);
        
        showPaymentOptions(quantity, totalPrice);
      }

      async function showPaymentOptions(quantity, totalPrice) {
        isWaitingPayment = true;
        comprovanteUploaded = false;
        
        const pixInfoHTML = `
          <div class="pix-info">
            <p><strong>üìå Chave Pix (CPF):</strong> ${PIX_KEY}</p>
            <p><strong>üìå Nome:</strong> ${RECEIVER_NAME}</p>
            <p><strong>üü¢ Obs.:</strong> O nome que aparece √© do meu corninho, t√° bom? Pode fazer tranquilo(a), t√° tudo certinho! rsrs üòú</p>
            <p><strong>üí∞ Valor:</strong> R$ ${totalPrice},00</p>
            <div class="pdf-warning">
              <strong>üìÑ Aten√ß√£o:</strong> Voc√™ pode enviar o comprovante em imagem (JPG/PNG) ou em PDF. Assim que for verificado, as fotos ser√£o liberadas automaticamente.
            </div>
          </div>
          <div class="comprovante-container">
            <div class="upload-buttons">
              <label for="uploadComprovanteFoto" class="upload-label">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik00LDVIMjBWMThINFY1TTUsOEEyLDggMiA4QTIsMiAwIDAgMSA1LDZBMiwyIDAgMCwxIDcsOEEyLDIgMCAwLDEgNSwxMEEyLDIgMCAwLDEgMyw4QTIsMiAwIDAsMSA1LDZNNSwxMkwyMSwxMlYxOUg1VjEyWiIvPjwvc3ZnPg==" alt="Enviar imagem" />
                Enviar Comprovante em Foto
              </label>
              <label for="uploadComprovantePDF" class="upload-label">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik0xMyw5SDE4LjVMMTMsMy41VjlNMTksMTBWMTlINVY1SDEyVjE5SDE5VjEwSDE5TTIwLDJIMTlWNkg5VjJIN0YyMkgxN1YyMkgyMFYyWiIvPjwvc3ZnPg==" alt="Enviar PDF" />
                Enviar Comprovante em PDF
              </label>
            </div>
            <input type="file" accept="image/*" id="uploadComprovanteFoto" style="display: none" />
            <input type="file" accept=".pdf" id="uploadComprovantePDF" style="display: none" />
          </div>
        `;
        
        appendMessage("bot", pixInfoHTML);
        
        // Configurar os listeners para os uploads
        document.getElementById('uploadComprovanteFoto').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'image', quantity, totalPrice);
            comprovanteUploaded = true;
          }
        });
        
        document.getElementById('uploadComprovantePDF').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'pdf', quantity, totalPrice);
            comprovanteUploaded = true;
          }
        });
      }

      async function handleComprovanteUpload(event, type, quantity, totalPrice) {
        const file = event.target.files[0];
        if (!file) return;
        
        try {
          if (type === 'pdf') {
            await processPDFComprovante(file);
          } else {
            await processImageComprovante(file);
          }
          
          appendMessage("bot", "üîÑ S√≥ um momento, meu amor... Estou validando seu pagamento. Assim que for confirmado, te mando as fotos! üòâ");
          
          showTypingIndicator();
          
          if (type === 'pdf') {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let extractedText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
              const page = await pdf.getPage(i);
              const textContent = await page.getTextContent();
              const strings = textContent.items.map(item => item.str);
              extractedText += strings.join(' ') + '\n';
            }
            
            await verifyComprovanteText(extractedText, quantity, totalPrice);
          } else {
            const reader = new FileReader();
            const imageData = await new Promise((resolve, reject) => {
              reader.onload = e => resolve(e.target.result);
              reader.onerror = reject;
              reader.readAsDataURL(file);
            });
            await verifyComprovante(imageData, quantity, totalPrice);
          }
        } catch (error) {
          console.error("Erro ao processar comprovante:", error);
          hideTypingIndicator();
          showComprovanteError(quantity, totalPrice);
        }
      }

      async function processImageComprovante(file) {
        const reader = new FileReader();
        return new Promise((resolve, reject) => {
          reader.onload = function(e) {
            const previewHTML = `
              <div class="comprovante-container">
                <img src="${e.target.result}" class="comprovante-preview">
              </div>
            `;
            appendMessage("user", previewHTML);
            resolve();
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      async function processPDFComprovante(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        
        const page = await pdf.getPage(1);
        const viewport = page.getViewport({ scale: 1.0 });
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        
        await page.render({
          canvasContext: context,
          viewport: viewport
        }).promise;
        
        const previewImage = canvas.toDataURL('image/jpeg');
        
        const previewHTML = `
          <div class="comprovante-container">
            <img src="${previewImage}" class="comprovante-preview">
          </div>
        `;
        appendMessage("user", previewHTML);
      }

      async function verifyComprovante(imageData, quantity, totalPrice) {
        try {
          const { data: { text } } = await Tesseract.recognize(
            imageData,
            'por',
            { logger: m => console.log(m) }
          );
          
          await verifyComprovanteText(text, quantity, totalPrice);
        } catch (error) {
          console.error("Erro ao verificar comprovante:", error);
          throw error;
        }
      }

      async function verifyComprovanteText(text, quantity, totalPrice) {
        hideTypingIndicator();
        
        // Verificar se o texto cont√©m qualquer uma das palavras-chave do nome do recebedor e o valor correto
        const normalizedText = text.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        const hasReceiverName = RECEIVER_KEYWORDS.some(keyword => normalizedText.includes(keyword));
        
        const hasCorrectAmount = text.includes(`${totalPrice},00`) || 
                               text.includes(`${totalPrice}.00`) || 
                               text.includes(`R$ ${totalPrice}`) || 
                               text.includes(`R$${totalPrice}`);
        
        if (hasReceiverName && hasCorrectAmount) {
          // Mostrar mensagem de sucesso
          const successHTML = `
            <div class="success-message">
              ‚úÖ Pagamento confirmado! Obrigada, meu amor! üòò
            </div>
            <p>Aqui est√£o suas ${quantity > 1 ? quantity + ' fotos' : 'foto'} especiais... Espero que goste! üíã</p>
          `;
          appendMessage("bot", successHTML);
          
          // Mostrar as fotos
          await deliverPhotos(quantity);
        } else {
          showComprovanteError(quantity, totalPrice);
        }
      }

      async function deliverPhotos(quantity) {
        const photoPackageHTML = `
          <div class="photo-package">
            <p>Pacote com ${quantity} ${quantity > 1 ? 'fotos' : 'foto'} especial${quantity > 1 ? 'is' : ''} para voc√™:</p>
            ${Array.from({length: quantity}, (_, i) => {
              const photoNum = currentPhotoIndex + i;
              return `<img src="foto${photoNum}.webp" class="preview-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzljMjdCMCI+PHBhdGggZD0iTTgsNUgxOEExLDcgMSAwLDEgMTksMTJWMThBMSwxIDAgMCwxIDE4LDE5SDhBNywwIDAgMCwxIDEsMTJWNUExLDEgMCAwLDEgOCw1TTEyLDEwQTIsMiAwIDAsMCAxMCwxMkEyLDIgMCAwLDAgMTIsMTRBMiwyIDAgMCwwIDE0LDEyQTIsMiAwIDAsMCAxMiwxMFoiLz48L3N2Zz4='">`;
            }).join('')}
            <p>Gostou do que viu? Quer mais fotos? üòè</p>
            <div class="option-buttons">
              <button class="option-button" onclick="handlePhotoInterest('1 foto')">1 foto (R$ 2)</button>
              <button class="option-button" onclick="handlePhotoInterest('2 fotos')">2 fotos (R$ 4)</button>
              <button class="option-button" onclick="handlePhotoInterest('3 fotos')">3 fotos (R$ 6)</button>
              <button class="option-button" onclick="handlePhotoInterest('5 fotos')">5 fotos (R$ 10)</button>
            </div>
          </div>
        `;
        
        appendMessage("bot", photoPackageHTML);
        
        // Atualizar o √≠ndice para o pr√≥ximo pacote
        currentPhotoIndex += quantity;
        if (currentPhotoIndex > 100) currentPhotoIndex = 1; // Volta ao in√≠cio se passar de 100 fotos
        
        // Resetar estado de pagamento
        isWaitingPayment = false;
        comprovanteUploaded = false;
      }

      function showComprovanteError(quantity, totalPrice) {
        let errorMessage = '<div class="error-message">‚ùå N√£o consegui confirmar seu pagamento, amor</div>';
        errorMessage += '<p>Por favor, verifique se:</p>';
        errorMessage += '<ul>';
        errorMessage += `<li>Voc√™ enviou o comprovante do Pix para a chave <strong>${PIX_KEY}</strong> (CPF)</li>`;
        errorMessage += `<li>O valor est√° correto: <strong>R$ ${totalPrice},00</strong></li>`;
        errorMessage += '</ul>';
        errorMessage += '<p>Se j√° conferiu tudo e ainda assim n√£o foi validado, pode enviar novamente o comprovante?</p>';
        errorMessage += `
          <div class="comprovante-container">
            <div class="upload-buttons">
              <label for="uploadComprovanteFoto" class="upload-label">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik00LDVIMjBWMThINFY1TTUsOEEyLDggMiA4QTIsMiAwIDAgMSA1LDZBMiwyIDAgMCwxIDcsOEEyLDIgMCAwLDEgNSwxMEEyLDIgMCAwLDEgMyw4QTIsMiAwIDAsMSA1LDZNNSwxMkwyMSwxMlYxOUg1VjEyWiIvPjwvc3ZnPg==" alt="Enviar imagem" />
                Enviar Comprovante em Foto
              </label>
              <label for="uploadComprovantePDF" class="upload-label">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik0xMyw5SDE4LjVMMTMsMy41VjlNMTksMTBWMTlINVY1SDEyVjE5SDE5VjEwSDE5TTIwLDJIMTlWNkg5VjJIN0YyMkgxN1YyMkgyMFYyWiIvPjwvc3ZnPg==" alt="Enviar PDF" />
                Enviar Comprovante em PDF
              </label>
            </div>
            <input type="file" accept="image/*" id="uploadComprovanteFoto" style="display: none" />
            <input type="file" accept=".pdf" id="uploadComprovantePDF" style="display: none" />
          </div>
        `;
        
        appendMessage("bot", errorMessage);
        
        // Configurar novamente os listeners
        comprovanteUploaded = false;
        document.getElementById('uploadComprovanteFoto').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'image', quantity, totalPrice);
            comprovanteUploaded = true;
          }
        });
        
        document.getElementById('uploadComprovantePDF').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'pdf', quantity, totalPrice);
            comprovanteUploaded = true;
          }
        });
      }

      function handleKeyPress(event) {
        if (event.key === 'Enter' && !isWaitingResponse) {
          sendMessage();
        }
      }

      async function sendMessage() {
        if (isWaitingResponse) return;
        const text = userInput.value.trim();
        if (!text) return;
        
        appendMessage("user", text);
        userInput.value = "";
        updateActionIcon();
        isWaitingResponse = true;
        
        // Configurar o delay para mostrar "digitando..."
        typingTimeout = setTimeout(() => {
          showTypingIndicator();
        }, 5000); // 5 segundos de delay
        
        const lower = text.toLowerCase();
        const normalized = lower.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        
        // Verificar se o usu√°rio est√° enviando uma imagem
        if (document.getElementById('uploadImage').files.length > 0) {
          clearTimeout(typingTimeout);
          hideTypingIndicator();
          await handleImageUpload(document.getElementById('uploadImage').files[0]);
          isWaitingResponse = false;
          return;
        }
        
        // Capturar nome do usu√°rio
        if (!userName && (normalized.includes('meu nome √©') || normalized.includes('eu sou') || normalized.includes('me chamo'))) {
          const nameMatch = text.match(/(?:meu nome √©|eu sou|me chamo)\s+([^\s,.!?]+)/i);
          if (nameMatch && nameMatch[1]) {
            userName = nameMatch[1];
          }
        }
        
        // Perguntas sobre Suellen
        if (normalized.includes('quem e suellen') || normalized.includes('quem √© suellen') ||
            normalized.includes('quem e voce') || normalized.includes('quem √© voc√™') ||
            normalized.includes('quem e vc') || normalized.includes('quem √© vc') ||
            (normalized.includes('de onde') && normalized.includes('suellen')) ||
            normalized.includes('onde mora') || normalized.includes('onde vive') ||
            normalized.includes('vc √© de onde') || normalized.includes('voc√™ √© de onde')) {
          clearTimeout(typingTimeout);
          hideTypingIndicator();
          await simulateTyping("Eu sou a Suellen, uma garota que adora conversas quentes e fotos provocantes... Tenho 24 anos, sou de Florian√≥polis agora, mas nasci em Cachoeira de Itabuna, na Bahia. Adoro praia, m√∫sica e conversas interessantes como a nossa! üòò");
          isWaitingResponse = false;
          return;
        }
        
        // Hist√≥ria pessoal
        if (normalized.includes('hist√≥ria') || normalized.includes('vida') || normalized.includes('passado') ||
            normalized.includes('como voc√™ come√ßou') || normalized.includes('como vc come√ßou')) {
          clearTimeout(typingTimeout);
          hideTypingIndicator();
          await simulateTyping("Ah, quer saber da minha hist√≥ria? Eu era uma garota t√≠mida na Bahia, at√© que descobri meu lado mais ousado... rsrs");
          await simulateTyping("Me mudei pra Floripa pra viver mais livre, conhecer gente interessante como voc√™! Foi a melhor decis√£o da minha vida! üòä");
          isWaitingResponse = false;
          return;
        }
        
        // Pedido de fotos
        if (normalized.includes('foto') || normalized.includes('fotos') || normalized.includes('fotinha') || 
            normalized.includes('fotinhas') || normalized.includes('ver foto') || normalized.includes('ver fotos') ||
            normalized.includes('me manda foto') || normalized.includes('me manda fotos') || normalized.includes('manda foto') ||
            normalized.match(/\b(\d+)\s*fotos?\b/i)) {
          clearTimeout(typingTimeout);
          hideTypingIndicator();
          
          // Extrair quantidade de fotos solicitadas
          const quantityMatch = normalized.match(/\b(\d+)\s*fotos?\b/i);
          let quantity = 1;
          let optionText = '1 foto';
          
          if (quantityMatch) {
            quantity = parseInt(quantityMatch[1]);
            if (quantity > 10) quantity = 10; // Limite m√°ximo
            optionText = quantity + (quantity > 1 ? ' fotos' : ' foto');
          }
          
          await handlePhotoInterest(optionText);
          isWaitingResponse = false;
          return;
        }
        
        // Se n√£o for nenhum dos casos acima, usa a resposta personalizada
        clearTimeout(typingTimeout);
        hideTypingIndicator();
        await generateFlirtyResponse(text);
        isWaitingResponse = false;
      }

      async function generateFlirtyResponse(text) {
        // Respostas picantes se a conversa estiver mais √≠ntima
        const spicyResponses = [
          "Eu quero gozar... üòèü§§",
          "T√¥ louca pra sentar no seu pau... üòàüî•",
          "Quero te dar de todas as formas poss√≠veis... ü•µ",
          "Quero ficar de quatro pra voc√™... üòè",
          "Quero ver teu pau... Manda uma foto pra mim? ü§§",
          "Nossa, s√≥ de imaginar voc√™ me comendo j√° fico toda molhada... üí¶",
          "Voc√™ me deixa com tanto tes√£o que at√© me tremo toda... üò´",
          "Quero sentir voc√™ dentro de mim at√© eu gozar... ü•¥",
          "Me diz como voc√™ me quer... Por tr√°s? De quatro? Eu topo tudo! üòà",
          "Adoro um homem que sabe o que quer... E voc√™ quer me comer, n√£o √©? üòè"
        ];
        
        // Respostas mais leves para in√≠cio de conversa
        const lightResponses = [
          `Hmm, gosto do que est√° dizendo... Me conta mais sobre voc√™${userName ? ', ' + userName : ''}! üòâ`,
          `Voc√™ tem um jeito t√£o interessante de falar... Me deixa curiosa para saber mais${userName ? ', ' + userName : ''}! üòò`,
          `Adoro essa energia que voc√™ est√° trazendo... Me diz, o que mais voc√™ gosta${userName ? ', ' + userName : ''}? üòä`,
          `Nossa, com essa conversa voc√™ est√° me deixando com vontade de te conhecer melhor${userName ? ', ' + userName : ''}... üòè`,
          `Voc√™ tem um jeito t√£o cativante... Me conta, o que te faz sentir mais vivo${userName ? ', ' + userName : ''}? üòà`,
          `Adoro quando a conversa fica assim... Quer me contar um segredo${userName ? ', ' + userName : ''}? üòâ`,
          `Hmm, com esse papo voc√™ est√° me deixando com vontade de te mostrar umas coisinhas... Quer ver${userName ? ', ' + userName : ''}? üòò`,
          `Voc√™ sabe como manter uma garota interessada, n√£o √©${userName ? ', ' + userName : ''}? Me diz, o que mais voc√™ quer saber? üòä`,
          `Adoro essa conex√£o que estamos criando... Quer levar isso para um n√≠vel mais √≠ntimo${userName ? ', ' + userName : ''}? üòè`,
          `Com esse papo, voc√™ est√° me deixando com vontade de te presentear com umas fotos especiais... Quer${userName ? ', ' + userName : ''}? üòà`
        ];
        
        // Escolher entre respostas picantes ou leves baseado no n√≠vel da conversa
        const useSpicy = Math.random() > 0.7 && document.getElementById('chatBody').children.length > 5;
        const responses = useSpicy ? spicyResponses : lightResponses;
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        
        await simulateTyping(randomResponse);
        
        // Oferecer fotos ap√≥s algumas mensagens
        if (Math.random() > 0.7) {
          await simulateTyping("Quer ver umas fotos minhas bem especiais? S√£o R$ 2 por foto... Quantas voc√™ quer?");
          
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handlePhotoInterest('1 foto')">1 foto (R$ 2)</button>
              <button class="option-button" onclick="handlePhotoInterest('2 fotos')">2 fotos (R$ 4)</button>
              <button class="option-button" onclick="handlePhotoInterest('3 fotos')">3 fotos (R$ 6)</button>
              <button class="option-button" onclick="handlePhotoInterest('5 fotos')">5 fotos (R$ 10)</button>
            </div>
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('Continuar conversando')">üí¨ Continuar conversando</button>
            </div>`);
        }
      }

      function handleOptionClick(option) {
        appendMessage("user", option);
        
        if (option === 'Continuar conversando') {
          simulateTyping(`Adoro continuar conversando com voc√™${userName ? ', ' + userName : ''}... Me conta, o que voc√™ gosta de fazer nos seus momentos livres? üòä`);
        }
      }

      function showTypingIndicator() {
        if (!typingEl) {
          typingEl = document.createElement("div");
          typingEl.className = "typing-indicator";
          typingEl.innerHTML = "<span></span><span></span><span></span>";
          document.getElementById("chatBody").appendChild(typingEl);
          document.getElementById("chatBody").scrollTop = document.getElementById("chatBody").scrollHeight;
        }
      }

      function hideTypingIndicator() {
        if (typingEl) {
          typingEl.remove();
          typingEl = null;
        }
        if (typingTimeout) {
          clearTimeout(typingTimeout);
          typingTimeout = null;
        }
      }

      async function simulateTyping(message, delay = 1500) {
        // Calcular tempo de digita√ß√£o baseado no tamanho da mensagem
        const typingTime = Math.min(Math.max(message.length * 30, 1000), 4000); // Entre 1 e 4 segundos
        showTypingIndicator();
        await new Promise(r => setTimeout(r, typingTime));
        hideTypingIndicator();
        if (message) {
          appendMessage("bot", message);
        }
      }

      function appendMessage(sender, message) {
        const chatBody = document.getElementById("chatBody");
        const msgEl = document.createElement("div");
        msgEl.className = `message ${sender}`;
        msgEl.innerHTML = message;
        chatBody.appendChild(msgEl);
        chatBody.scrollTop = chatBody.scrollHeight;
      }
    </script>
  </body>
</html>
