<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suellen Rocha</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #e5ddd5;
            background-image: linear-gradient(#e5ddd5, #d2dbd0);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            background-color: #075e54;
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        .chat-name {
            font-weight: 500;
            font-size: 16px;
        }

        .chat-status {
            font-size: 12px;
            opacity: 0.8;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px;
            background-image: url('https://web.whatsapp.com/img/bg-chat-tile-light_a4be512e7195b6b733d9110b408f075d.png');
            background-repeat: repeat;
        }

        .message {
            max-width: 70%;
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 7.5px;
            position: relative;
            word-wrap: break-word;
        }

        .received {
            background-color: white;
            align-self: flex-start;
            margin-right: auto;
        }

        .sent {
            background-color: #dcf8c6;
            align-self: flex-end;
            margin-left: auto;
        }

        .typing-indicator {
            display: inline-block;
            background-color: white;
            padding: 8px 12px;
            border-radius: 7.5px;
            margin-bottom: 10px;
        }

        .typing-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #999;
            margin-right: 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
            margin-right: 0;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .input-container {
            display: flex;
            padding: 8px;
            background-color: #f0f0f0;
            border-top: 1px solid #ddd;
        }

        .message-input {
            flex: 1;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            margin: 0 5px;
            outline: none;
            font-size: 14px;
        }

        .attach-button, .camera-button {
            width: 24px;
            height: 24px;
            padding: 8px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .attach-button:hover, .camera-button:hover {
            opacity: 1;
        }

        .file-input {
            display: none;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .photo-item {
            width: 100%;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .photo-item:hover {
            transform: scale(1.02);
        }

        .photo-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }

        .timestamp {
            font-size: 11px;
            color: #666;
            text-align: right;
            margin-top: 3px;
        }

        .received .timestamp {
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <img src="perfil.webp" alt="Suellen Rocha" class="profile-pic">
            <div>
                <div class="chat-name">Suellen Rocha</div>
                <div class="chat-status">online</div>
            </div>
        </div>

        <div class="messages-container" id="messages-container">
            <!-- Messages will be inserted here -->
        </div>

        <div class="input-container">
            <label for="attach-file">
                <img src="https://cdn-icons-png.flaticon.com/512/126/126477.png" alt="Anexar" class="attach-button">
            </label>
            <input type="file" id="attach-file" class="file-input" accept="image/*,.pdf">
            
            <input type="text" class="message-input" id="message-input" placeholder="Digite uma mensagem...">
            
            <label for="send-photo">
                <img src="https://cdn-icons-png.flaticon.com/512/126/126477.png" alt="C√¢mera" class="camera-button">
            </label>
            <input type="file" id="send-photo" class="file-input" accept="image/*" capture="camera">
        </div>
    </div>

    <div class="photo-modal" id="photo-modal">
        <span class="close-modal">&times;</span>
        <img class="modal-content" id="modal-image">
    </div>

    <script>
        // API key for Gemini
        const API_KEY = "AIzaSyBHUWSEIVXy3z0NT13ps8aU5TOZJWuC9ss";
        
        // DOM elements
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const attachFile = document.getElementById('attach-file');
        const sendPhoto = document.getElementById('send-photo');
        const photoModal = document.getElementById('photo-modal');
        const modalImage = document.getElementById('modal-image');
        const closeModal = document.querySelector('.close-modal');
        
        // Chat state
        let waitingForPayment = false;
        let photoCount = 0;
        let totalValue = 0;
        
        // Initial message with delays
        setTimeout(() => {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('Oi√™, meu bem! Que bom te ver por aqui... üôà', 'received');
            }, 4000);
        }, 3000);
        
        // Event listeners
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && messageInput.value.trim() !== '') {
                sendMessage(messageInput.value);
                messageInput.value = '';
            }
        });
        
        attachFile.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        sendPhoto.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        closeModal.addEventListener('click', function() {
            photoModal.style.display = 'none';
        });
        
        // Functions
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator received';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        function addMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            
            messageDiv.innerHTML = `
                <div>${text}</div>
                <div class="timestamp">${hours}:${minutes}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function sendMessage(text) {
            addMessage(text, 'sent');
            
            // Process user message
            if (waitingForPayment) {
                // Already in payment flow, ignore other messages
                return;
            }
            
            // Check if user is asking for photos
            const photoMatch = text.match(/\b(\d{1,3})\b/);
            if (photoMatch && !isNaN(photoMatch[1])) {
                const count = parseInt(photoMatch[1]);
                if (count >= 1 && count <= 100) {
                    startPaymentFlow(count);
                } else {
                    setTimeout(() => {
                        showTypingIndicator();
                        
                        setTimeout(() => {
                            hideTypingIndicator();
                            addMessage('Meu bem, s√≥ posso vender de 1 at√© 100 fotinhas, t√°? üòò Escolhe a√≠ entre esses valores... üòàüî•', 'received');
                        }, 4000);
                    }, 3000);
                }
            } else if (text.toLowerCase().includes('foto') || text.toLowerCase().includes('fotinha') || text.toLowerCase().includes('pacote')) {
                setTimeout(() => {
                    showTypingIndicator();
                    
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage('Quantas fotinhas voc√™ quer, meu amor? Cada uma custa R$ 2,00... Pode pedir de 1 at√© 100, viu? üòè‚ù§Ô∏è', 'received');
                    }, 4000);
                }, 3000);
            } else {
                // Default response
                setTimeout(() => {
                    showTypingIndicator();
                    
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage('Hmm... quer minhas fotinhas especiais, amor? S√≥ me dizer quantas voc√™ quer... de 1 at√© 100, t√° bom? üòàüî•', 'received');
                    }, 4000);
                }, 3000);
            }
        }
        
        function startPaymentFlow(count) {
            photoCount = count;
            totalValue = count * 2;
            waitingForPayment = true;
            
            // Send messages with delays
            setTimeout(() => {
                showTypingIndicator();
                
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage(`Claro, meu bem‚Ä¶ üíã\nEsse pacotinho com ${photoCount} fotinhas sai por R$ ${totalValue},00 üòàüî•`, 'received');
                    
                    // Second message after delay
                    setTimeout(() => {
                        showTypingIndicator();
                        
                        setTimeout(() => {
                            hideTypingIndicator();
                            addMessage('A chave Pix √©: 98981420070 ‚ú®', 'received');
                            
                            // Third message after delay
                            setTimeout(() => {
                                showTypingIndicator();
                                
                                setTimeout(() => {
                                    hideTypingIndicator();
                                    addMessage('O Pix t√° no nome do meu assessor, t√° bom?\n√â s√≥ mandar o comprovante aqui no chat que eu libero tudinho rapidinho‚Ä¶ üòèüî•\nT√¥ aqui s√≥ te esperando, meu bem‚Ä¶ ‚ù§Ô∏èüòà', 'received');
                                }, 4000);
                            }, 2000);
                        }, 4000);
                    }, 2000);
                }, 4000);
            }, 3000);
        }
        
        function handleFileUpload(file) {
            if (!waitingForPayment) {
                addMessage('Me envia o comprovante s√≥ depois que eu te passar os valores, t√° bom, amor? üòò', 'received');
                return;
            }
            
            // Check if it's an image or PDF
            if (!file.type.match('image.*') && !file.type.match('application/pdf')) {
                addMessage('Me manda s√≥ imagem ou PDF do comprovante, meu bem... ‚ù§Ô∏è', 'received');
                return;
            }
            
            // Display the sent file
            if (file.type.match('image.*')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    addMessage('<div style="max-width: 200px;"><img src="' + e.target.result + '" style="max-width: 100%; border-radius: 5px;"></div>', 'sent');
                    validateReceipt(file);
                };
                reader.readAsDataURL(file);
            } else {
                addMessage('üìÑ Comprovante PDF enviado', 'sent');
                validateReceipt(file);
            }
        }
        
        async function validateReceipt(file) {
            // Show typing indicator while processing
            showTypingIndicator();
            
            try {
                // In a real implementation, you would send the file to an OCR API
                // For this example, we'll simulate OCR processing with a delay
                
                setTimeout(async () => {
                    hideTypingIndicator();
                    
                    // Simulate OCR results (in a real app, you'd get this from the API)
                    let ocrText = "";
                    let isValid = false;
                    
                    if (file.name.includes("valid")) {
                        // Simulate a valid receipt
                        ocrText = `Antonio\nValor: R$ ${totalValue},00`;
                        isValid = true;
                    } else {
                        // Simulate random text for invalid receipt
                        ocrText = "Comprovante qualquer\nValor: R$ 50,00\nNome: Jo√£o Silva";
                    }
                    
                    // Check if the receipt is valid
                    const validNames = ["Antonio", "Renimar", "Pinheiro", "Almeida"];
                    const hasValidName = validNames.some(name => ocrText.includes(name));
                    const hasValidValue = ocrText.includes(`R$ ${totalValue},`) || 
                                        ocrText.includes(`R$ ${totalValue}.`);
                    
                    if (hasValidName && hasValidValue) {
                        // Valid receipt
                        addMessage('Comprovante validado, meu amor... üòàüî•\nAguarda s√≥ um pouquinho que j√° vou liberar suas fotinhas... ü§§‚ù§Ô∏è', 'received');
                        
                        // Deliver photos after delay
                        setTimeout(() => {
                            deliverPhotos(photoCount);
                        }, 3000);
                    } else {
                        // Invalid receipt
                        addMessage('Hmm... n√£o consegui validar seu comprovante, amor üò¢\nD√° uma olhadinha se t√° tudo certinho e me manda de novo, t√°? üòò', 'received');
                    }
                    
                    waitingForPayment = false;
                }, 4000);
                
            } catch (error) {
                hideTypingIndicator();
                addMessage('Ocorreu um erro ao validar seu comprovante, amor... üò¢\nPode tentar de novo? ‚ù§Ô∏è', 'received');
                console.error('Error validating receipt:', error);
            }
        }
        
        function deliverPhotos(count) {
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                
                // Create photo grid
                let photosHTML = '<div class="photo-grid">';
                for (let i = 1; i <= count; i++) {
                    const photoNum = (i % 100) || 100; // Cycle through 1-100 if count > 100
                    photosHTML += `<img src="foto${photoNum}.webp" class="photo-item" onclick="openModal('foto${photoNum}.webp')">`;
                }
                photosHTML += '</div>';
                
                addMessage(`Aqui est√£o suas ${count} fotinhas, meu bem... aproveita bastante! üòàüî•‚ù§Ô∏è\n${photosHTML}`, 'received');
                
                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 4000);
        }
        
        function openModal(src) {
            modalImage.src = src;
            photoModal.style.display = 'flex';
        }
    </script>
</body>
</html>
