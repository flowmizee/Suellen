<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suellen Rocha - Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #28004D;
            --bg-medium: #4A0080;
            --accent-pink: #FF69B4;
            --accent-red: #FF007F;
            --text-light: #F0F0F0;
            --text-dark: #333333;
            --bubble-user: #FF69B4;
            --bubble-suellen: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 100%;
            height: 100vh;
            max-width: 450px;
            margin: 0 auto;
            position: relative;
            background-color: var(--bg-medium);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-pink) 100%);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
            flex-shrink: 0;
        }

        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--text-light);
            margin-right: 15px;
        }

        .header-info h2 {
            margin: 0;
            font-size: 1.2em;
            color: var(--text-light);
            font-weight: 600;
        }

        .header-info p {
            margin: 0;
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
        }

        .chat-messages {
            flex-grow: 1;
            min-height: 0;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.4;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .message-bubble.user {
            background-color: var(--bubble-user);
            color: var(--text-light);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message-bubble.suellen {
            background-color: var(--bubble-suellen);
            color: var(--text-dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .message-bubble img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            margin-top: 5px;
            display: block;
        }

        .message-bubble.typing-indicator-bubble {
            background-color: var(--bubble-suellen);
            color: var(--text-dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            width: fit-content;
            opacity: 1;
        }

        .typing-dots {
            display: flex;
            align-items: center;
        }

        .typing-dots span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        .typing-dots span:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .chat-input-area {
            display: flex;
            padding: 15px 20px;
            background-color: var(--bg-medium);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 10;
            flex-shrink: 0;
        }

        .chat-input {
            flex-grow: 1;
            padding: 12px 18px;
            border: none;
            border-radius: 25px;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            font-size: 1em;
            outline: none;
            margin-right: 10px;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .send-button {
            background-color: var(--accent-pink);
            color: var(--text-light);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .send-button:hover {
            background-color: var(--accent-red);
        }

        .pix-upload-area {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--bg-medium);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 9;
            gap: 10px;
        }

        .pix-preview-container {
            width: 100%;
            max-height: 150px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        #receipt-preview {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            object-fit: contain;
        }

        #receipt-file-input {
            display: none;
        }

        .pix-upload-area .upload-type-button {
            width: 100%;
            border-radius: 25px;
            height: auto;
            padding: 10px 20px;
            background-color: var(--accent-pink);
            color: var(--text-light);
            border: none;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            margin-top: 5px;
        }

        .pix-upload-area .upload-type-button:hover {
            background-color: var(--accent-red);
            transform: translateY(-1px);
        }

        .status-message {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-top: 5px;
        }

        .custom-action-button {
            background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-pink) 100%);
            color: var(--text-light);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin-top: 10px;
            align-self: center;
            width: fit-content;
        }

        .custom-action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        .attachment-buttons {
            position: absolute;
            right: 85px;
            bottom: 18px;
            display: flex;
            gap: 5px;
        }

        .attachment-button {
            width: 30px;
            height: 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .attachment-button img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @media (max-width: 600px) {
            .chat-container {
                border-radius: 0;
                max-width: 100%;
            }
            .chat-header {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <img src="perfil.webp" alt="Suellen Rocha" class="profile-pic" onerror="this.onerror=null;this.src='https://placehold.co/100x100/FF69B4/FFFFFF?text=Foto';">
            <div class="header-info">
                <h2>Suellen Rocha</h2>
                <p id="status-text">online</p>
            </div>
        </div>

        <div class="chat-messages" id="chat-messages">
            <!-- Mensagens serão adicionadas aqui dinamicamente -->
        </div>

        <div class="pix-upload-area" id="pix-upload-area">
            <div class="pix-preview-container">
                <img id="receipt-preview" src="" alt="Pré-visualização do Comprovante" style="display: none;">
            </div>
            <p id="ocr-status-message" class="status-message"></p>
            <input type="file" id="receipt-file-input" accept="image/*">
            <button id="upload-photo-button" class="upload-type-button">
                Enviar Comprovante (Foto)
            </button>
        </div>

        <div class="chat-input-area" id="chat-input-area">
            <input type="text" id="chat-input" class="chat-input" placeholder="Digite sua mensagem...">
            <div class="attachment-buttons">
                <button class="attachment-button" id="attach-button">
                    <img src="anexar.webp" alt="Anexar" onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjEuNDQgMTEuMDVsLTkuMTkgOS4xOWE2IDYgMCAwIDEtOC40OS04LjQ5bDkuMTktOS4xOWE0IDQgMCAwIDEgNS42NiA1LjY2bC05LjIgOS4xOWEyIDIgMCAwIDEtMi44My0yLjgzbDguNDktOC40OCIvPjwvc3ZnPg==';">
                </button>
                <button class="attachment-button" id="send-photo-button">
                    <img src="enviarfoto.webp" alt="Enviar Foto" onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTIgMTNhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2eiIvPjxwYXRoIGQ9Ik0xOSA0SDVhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0YTIgMiAwIDAgMCAyLTJWNmEyIDIgMCAwIDAtMi0yeiIvPjxwYXRoIGQ9Ik0xNiAxN2E0IDQgMCAwIDAtNC00YTQgNCAwIDAgMC00IDQiLz48L3N2Zz4=';">
                </button>
            </div>
            <button id="send-button" class="send-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-horizontal"><path d="m3 3 3 9-3 9 19-9Z"/><path d="M6 12h16"/></svg>
            </button>
        </div>
    </div>

    <script src='https://unpkg.com/tesseract.js@5.0.0/dist/tesseract.min.js'></script>
    <script>
        // Elementos do DOM
        const chatContainer = document.querySelector('.chat-container');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const statusText = document.getElementById('status-text');
        const chatInputArea = document.getElementById('chat-input-area');
        const chatHeader = document.querySelector('.chat-header');
        const pixUploadArea = document.getElementById('pix-upload-area');
        const receiptFileInput = document.getElementById('receipt-file-input');
        const receiptPreview = document.getElementById('receipt-preview');
        const uploadPhotoButton = document.getElementById('upload-photo-button');
        const ocrStatusMessage = document.getElementById('ocr-status-message');
        const attachButton = document.getElementById('attach-button');
        const sendPhotoButton = document.getElementById('send-photo-button');

        // Estado do chat
        let chatHistory = [];
        let photosSentCount = 0;
        let expectedPaymentAmount = 0;
        let waitingForPaymentReceipt = false;
        let waitingForIntimatePhoto = false;
        let typingIndicatorElement = null;
        let customActionButton = null;
        let tesseractWorker = null;
        let currentPersonaMode = 'caring';
        let lastReceivedIntimatePhoto = false;

        // Função para ajustar a altura do container do chat
        function adjustChatContainerHeight() {
            chatContainer.style.height = `${window.innerHeight}px`;
            adjustChatMessagesPadding();
        }

        // Função para ajustar o padding das mensagens
        function adjustChatMessagesPadding() {
            const headerHeight = chatHeader.offsetHeight;
            const inputAreaHeight = chatInputArea.offsetHeight;
            let currentBottomPadding = inputAreaHeight + 20;

            if (pixUploadArea.style.display === 'flex') {
                const pixAreaVisibleHeight = pixUploadArea.offsetHeight;
                currentBottomPadding += pixAreaVisibleHeight;
                pixUploadArea.style.bottom = `${inputAreaHeight}px`;
            } else {
                pixUploadArea.style.bottom = `0px`;
            }
            
            chatMessages.style.paddingBottom = `${currentBottomPadding}px`;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Função para adicionar mensagem ao chat
        async function addMessage(text, sender, isImage = false, imageUrl = '') {
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble', sender);

            if (isImage) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = `Foto de ${sender}`;
                img.onload = () => {
                    adjustChatMessagesPadding();
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                };
                img.onerror = () => {
                    img.src = 'https://placehold.co/300x300/4A0080/FFFFFF?text=Imagem+não+encontrada';
                };
                messageBubble.appendChild(img);
            } else {
                messageBubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            }

            chatMessages.appendChild(messageBubble);
            adjustChatMessagesPadding();
        }

        // Função para adicionar indicador de digitação
        function addTypingIndicator() {
            if (typingIndicatorElement) return;

            typingIndicatorElement = document.createElement('div');
            typingIndicatorElement.classList.add('message-bubble', 'suellen', 'typing-indicator-bubble');
            typingIndicatorElement.innerHTML = `
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatMessages.appendChild(typingIndicatorElement);
            adjustChatMessagesPadding();
            chatMessages.scrollTop = chatMessages.scrollHeight;
            statusText.textContent = 'digitando...';
        }

        // Função para remover indicador de digitação
        function removeTypingIndicator() {
            if (typingIndicatorElement) {
                typingIndicatorElement.remove();
                typingIndicatorElement = null;
            }
            statusText.textContent = 'online';
            adjustChatMessagesPadding();
        }

        // Função para adicionar botão de ação personalizado
        function addCustomActionButton(text, onClickHandler) {
            if (customActionButton) {
                customActionButton.remove();
            }
            customActionButton = document.createElement('button');
            customActionButton.classList.add('custom-action-button');
            customActionButton.textContent = text;
            customActionButton.addEventListener('click', onClickHandler);
            chatMessages.appendChild(customActionButton);
            adjustChatMessagesPadding();
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Função para remover botão de ação personalizado
        function removeCustomActionButton() {
            if (customActionButton) {
                customActionButton.remove();
                customActionButton = null;
            }
            adjustChatMessagesPadding();
        }

        // Função para detectar intenção sensual na mensagem
        function detectSensualIntent(message) {
            const sensualKeywords = [
                'sexy', 'gostosa', 'nua', 'quero te ver', 'me manda foto íntima', 'tesão', 'safada',
                'provocar', 'provocante', 'delícia', 'maravilhosa', 'desejo', 'calor', 'quente',
                'corpo', 'intimidade', 'privado', 'pack', 'fotos sensuais', 'mostra', 'sem roupa',
                'pau', 'rola', 'pinto', 'buceta', 'xota', 'foda', 'sexo', 'gozar', 'chupar', 'punheta', 'duro', 'molhada'
            ];
            const normalizedMessage = message.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            return sensualKeywords.some(keyword => normalizedMessage.includes(keyword));
        }

        // Função para gerar respostas da Suellen
        function generateSuellenResponse(message) {
            const isSensual = detectSensualIntent(message);
            currentPersonaMode = isSensual ? 'sensual' : currentPersonaMode;

            // Verifica se o usuário está enviando uma foto
            const userIsSendingPhotoKeywords = ['vou te mandar foto', 'enviei minha foto', 'olha minha foto', 'te mandei uma foto'];
            const userIsSendingPhoto = userIsSendingPhotoKeywords.some(keyword => message.toLowerCase().includes(keyword));

            if (userIsSendingPhoto) {
                const responseOptions = [
                    "Ai, meu bem, mal posso esperar pra ver! 😏 Me manda logo!",
                    "Hmm, adoro quando você me surpreende assim... 🔥 Manda! Manda!",
                    "Que delícia, já estou curiosa! 🤤 Me mostra o que você tem de bom!",
                    "Você sabe como me deixar ansiosa, né? 😈 Tô esperando a sua foto!",
                    "Preparei meu coração pra essa... manda essa foto logo, amor! 🖤"
                ];
                return responseOptions[Math.floor(Math.random() * responseOptions.length)];
            }

            // Verifica se é um pedido de fotos
            const photoRequestKeywords = ['me manda foto', 'quero ver suas fotos', 'você tem fotos?', 'quanto custa suas fotos?'];
            const wantsPhotos = photoRequestKeywords.some(keyword => message.toLowerCase().includes(keyword));

            // Verifica quantidade solicitada
            const quantityMatch = message.match(/(\d+)\s*(fotos|foto)/i) || message.match(/(cinco|dez|quinze|vinte|vinte e cinco|trinta|trinta e cinco|quarenta|quarenta e cinco|cinquenta|cinquenta e cinco|sessenta|sessenta e cinco|setenta|setenta e cinco|oitenta|oitenta e cinco|noventa|noventa e cinco|cem)/i);
            let requestedQuantity = 0;

            if (quantityMatch) {
                const numText = quantityMatch[1] ? quantityMatch[1].toLowerCase() : quantityMatch[0].toLowerCase();
                switch (numText) {
                    case 'cinco': requestedQuantity = 5; break;
                    case 'dez': requestedQuantity = 10; break;
                    case 'quinze': requestedQuantity = 15; break;
                    case 'vinte': requestedQuantity = 20; break;
                    case 'vinte e cinco': requestedQuantity = 25; break;
                    case 'trinta': requestedQuantity = 30; break;
                    case 'trinta e cinco': requestedQuantity = 35; break;
                    case 'quarenta': requestedQuantity = 40; break;
                    case 'quarenta e cinco': requestedQuantity = 45; break;
                    case 'cinquenta': requestedQuantity = 50; break;
                    case 'cinquenta e cinco': requestedQuantity = 55; break;
                    case 'sessenta': requestedQuantity = 60; break;
                    case 'sessenta e cinco': requestedQuantity = 65; break;
                    case 'setenta': requestedQuantity = 70; break;
                    case 'setenta e cinco': requestedQuantity = 75; break;
                    case 'oitenta': requestedQuantity = 80; break;
                    case 'oitenta e cinco': requestedQuantity = 85; break;
                    case 'noventa': requestedQuantity = 90; break;
                    case 'noventa e cinco': requestedQuantity = 95; break;
                    case 'cem': requestedQuantity = 100; break;
                    default: requestedQuantity = parseInt(numText); break;
                }
            }

            // Lógica para pedidos de fotos
            if (wantsPhotos && requestedQuantity === 0) {
                return "Ah, você quer ver minhas fotos, é? 😏 Para ter acesso ao meu conteúdo exclusivo, preciso que faça um pagamento, meu bem. Quantas fotos você gostaria de ter? 😉";
            } else if (requestedQuantity >= 5 && requestedQuantity <= 100 && requestedQuantity % 5 === 0) {
                expectedPaymentAmount = (requestedQuantity / 5) * 10;
                waitingForPaymentReceipt = true;
                waitingForIntimatePhoto = false;
                
                return [
                    `Perfeito! 🔥 Para ${requestedQuantity} fotinhas exclusivas, o valor é R$${expectedPaymentAmount.toFixed(2).replace('.', ',')}. 😉`,
                    `Minha chave PIX é: \n\n**98981420070**`,
                    `A chave pix está no nome do meu assessor. Faz o pix e me manda o comprovante que libero rapidinho, amor! ❤️🤤`
                ];
            } else if (requestedQuantity !== 0 && (requestedQuantity < 5 || requestedQuantity > 100 || requestedQuantity % 5 !== 0)) {
                return "Hmm, meu bem, a quantidade de fotos precisa ser um múltiplo de 5, entre 5 e 100, tá? 😉 Qual quantidade você gostaria?";
            }

            // Respostas para fotos íntimas recebidas
            const lastPhotoKeywords = ['gostou', 'achou', 'minha foto', 'foto que te mandei'];
            const refersToLastIntimatePhoto = lastPhotoKeywords.some(keyword => message.toLowerCase().includes(keyword));

            if (lastReceivedIntimatePhoto && refersToLastIntimatePhoto) {
                const sensualResponses = [
                    "NOSSA! Que gostoso.... 🥵 Eu amei cada detalhe, me deixou com um calorzinho...",
                    "Eu sentaria até gozar 🤤 só de lembrar da sua foto... me deixou louca!",
                    "Vontade de te dar ficou grande agora 😋 depois de ver o que você me mandou... que delícia!",
                    "Que delícia...🤭 Sua foto não sai da minha cabeça, me deixou arrepiada!",
                    "Agora você mexeu comigo de um jeito que nem sei explicar... 😮‍💨 Me provoca mais, vai..."
                ];
                return sensualResponses[Math.floor(Math.random() * sensualResponses.length)];
            }

            // Respostas padrão baseadas no modo atual
            if (currentPersonaMode === 'sensual') {
                const sensualResponses = [
                    "Hmm, você sabe como me provocar, né? 😏",
                    "Que conversa mais gostosa... me deixou toda arrepiada! 🤤",
                    "Você tem um jeito tão especial de me deixar com calor... 🔥",
                    "Adoro quando você fala assim... me deixa toda molhadinha 😈",
                    "Só de conversar com você já fico toda excitada... 😘"
                ];
                return sensualResponses[Math.floor(Math.random() * sensualResponses.length)];
            } else {
                const caringResponses = [
                    "Que bom conversar com você, meu bem! ❤️",
                    "Adoro nosso papo, você é especial pra mim! 😊",
                    "Sempre fico feliz quando você me manda mensagem! 💋",
                    "Você é tão fofo... me conquista cada vez mais! 🥰",
                    "Nossa conversa é o melhor momento do meu dia! 😍"
                ];
                return caringResponses[Math.floor(Math.random() * caringResponses.length)];
            }
        }

        // Função para processar mensagem do usuário
        async function processUserMessage(message) {
            addMessage(message, 'user');
            chatHistory.push({ role: "user", parts: [{ text: message }] });

            removeCustomActionButton();

            // Adiciona delay antes de responder
            await new Promise(resolve => setTimeout(resolve, 1500));
            addTypingIndicator();
            await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 2000));
            removeTypingIndicator();

            const response = generateSuellenResponse(message);
            
            if (Array.isArray(response)) {
                // Resposta múltipla (para fluxo de pagamento)
                for (const msg of response) {
                    addMessage(msg, 'suellen');
                    chatHistory.push({ role: "model", parts: [{ text: msg }] });
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                if (waitingForPaymentReceipt) {
                    addCustomActionButton('Ver Fotos / Enviar Comprovante', () => {
                        chatInputArea.style.display = 'none';
                        pixUploadArea.style.display = 'flex';
                        adjustChatMessagesPadding();
                    });
                }
            } else {
                // Resposta única
                addMessage(response, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: response }] });
                
                if (response.toLowerCase().includes('fotinha sua') || response.toLowerCase().includes('foto íntima')) {
                    waitingForIntimatePhoto = true;
                    waitingForPaymentReceipt = false;
                }
            }
        }

        // Função para enviar fotos
        async function sendPhotos(numPhotosToDeliver) {
            const remainingPhotos = 100 - photosSentCount;
            const photosToSend = Math.min(numPhotosToDeliver, remainingPhotos);

            if (photosToSend <= 0) {
                addMessage("Já te enviei todas as fotos que tinha por agora, amor. Mas logo logo tem mais! 😉", 'suellen');
                return;
            }

            // Envia mensagem de confirmação primeiro
            addMessage("Pix confirmado, amor 😘... Aqui estão suas fotos 😈", 'suellen');

            // Envia as fotos
            for (let i = 0; i < photosToSend; i++) {
                const photoNumber = photosSentCount + 1;
                const imageUrl = `foto${photoNumber}.webp`;
                
                addMessage('', 'suellen', true, imageUrl);
                photosSentCount++;
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            // Envia mensagem após todas as fotos
            const followUpMessages = [
                "Espero que essas fotinhas deixem seu dia mais quente... 😏",
                "Gostou do que viu? Eu sabia que ia adorar... 🤤",
                "Agora você vai ficar me devendo uma visita... 😈",
                "Quer saber um segredo? Eu também me excitei tirando essas fotos... 🔥"
            ];
            const randomFollowUp = followUpMessages[Math.floor(Math.random() * followUpMessages.length)];
            addMessage(randomFollowUp, 'suellen');

            if (photosSentCount >= 100) {
                addMessage("Acabou por hoje, meu bem. Mas fica por perto... logo logo eu volto com mais surpresas 🔥", 'suellen');
            }
        }

        // Event listeners
        sendButton.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message) {
                chatInput.value = '';
                processUserMessage(message);
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });

        uploadPhotoButton.addEventListener('click', () => {
            receiptFileInput.click();
        });

        attachButton.addEventListener('click', () => {
            receiptFileInput.click();
        });

        sendPhotoButton.addEventListener('click', () => {
            receiptFileInput.click();
        });

        // Processar upload de imagem/comprovante
        receiptFileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) {
                pixUploadArea.style.display = 'none';
                chatInputArea.style.display = 'flex';
                adjustChatMessagesPadding();
                receiptPreview.style.display = 'none';
                ocrStatusMessage.textContent = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = async (e) => {
                // Mostra a imagem no chat como mensagem do usuário
                await addMessage('', 'user', true, e.target.result);
                
                // Esconde a área de upload e volta para o chat
                pixUploadArea.style.display = 'none';
                chatInputArea.style.display = 'flex';
                adjustChatMessagesPadding();

                // Mostra indicador de digitação
                await new Promise(resolve => setTimeout(resolve, 1500));
                addTypingIndicator();
                await new Promise(resolve => setTimeout(resolve, 2000));
                removeTypingIndicator();

                // Tenta processar como comprovante PIX
                try {
                    if (!tesseractWorker) {
                        ocrStatusMessage.textContent = 'Preparando validador de pagamento...';
                        tesseractWorker = await Tesseract.createWorker('por');
                    }

                    ocrStatusMessage.textContent = 'Validando pagamento...';
                    const { data: { text } } = await tesseractWorker.recognize(e.target.result);
                    
                    const normalizedText = text.toLowerCase()
                        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                        .replace(/[^a-z0-9\s.,]/g, "");

                    const nameKeywords = ['antonio', 'renimar', 'pinheiro', 'almeida'];
                    const nameMatches = nameKeywords.some(keyword => normalizedText.includes(keyword));

                    const amountPattern = /(\d{1,3}(?:[.,]\d{2})?)/g;
                    const validAmountsMap = {
                        10: 5, 20: 10, 30: 15, 40: 20, 50: 25,
                        60: 30, 70: 35, 80: 40, 90: 45, 100: 50
                    };

                    let extractedAmount = 0;
                    let match;
                    
                    while ((match = amountPattern.exec(normalizedText)) !== null) {
                        const amountStr = match[1].replace(',', '.');
                        const currentAmount = parseFloat(amountStr);
                        const roundedAmount = Math.round(currentAmount * 100) / 100;

                        if (validAmountsMap.hasOwnProperty(roundedAmount)) {
                            extractedAmount = roundedAmount;
                            break;
                        }
                    }

                    if (nameMatches && extractedAmount > 0 && validAmountsMap[extractedAmount]) {
                        // É um comprovante válido
                        const photosToDeliver = validAmountsMap[extractedAmount];
                        await sendPhotos(photosToDeliver);
                        waitingForPaymentReceipt = false;
                        lastReceivedIntimatePhoto = false;
                    } else {
                        // Não é um comprovante válido - trata como foto íntima
                        currentPersonaMode = 'sensual';
                        const sensualResponses = [
                            "NOSSA! Que gostoso.... 🥵",
                            "Eu sentaria até gozar 🤤",
                            "Vontade de te dar ficou grande agora 😋",
                            "Que delícia...🤭",
                            "Agora você mexeu comigo de um jeito que nem sei explicar... 😮‍💨 Me provoca mais, vai..."
                        ];
                        const randomResponse = sensualResponses[Math.floor(Math.random() * sensualResponses.length)];
                        addMessage(randomResponse, 'suellen');
                        lastReceivedIntimatePhoto = true;
                    }
                } catch (error) {
                    console.error('Erro no OCR:', error);
                    // Se o OCR falhar, trata como foto íntima
                    currentPersonaMode = 'sensual';
                    addMessage("Que foto gostosa, meu bem... me deixou toda excitada! 😈", 'suellen');
                    lastReceivedIntimatePhoto = true;
                } finally {
                    receiptFileInput.value = '';
                    ocrStatusMessage.textContent = '';
                }
            };
            
            if (file.type.startsWith('image/')) {
                reader.readAsDataURL(file);
            } else {
                addMessage("Por favor, envie apenas imagens ou comprovantes no formato correto.", 'suellen');
                receiptFileInput.value = '';
            }
        });

        // Inicialização do chat
        window.onload = async () => {
            adjustChatContainerHeight();
            window.addEventListener('resize', adjustChatContainerHeight);
            
            // Saudação inicial
            await new Promise(resolve => setTimeout(resolve, 2000));
            addTypingIndicator();
            await new Promise(resolve => setTimeout(resolve, 2500));
            removeTypingIndicator();
            addMessage("Olá, meu bem! Que bom te ver por aqui... 🙈", 'suellen');
        };
    </script>
</body>
</html>
