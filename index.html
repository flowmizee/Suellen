<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suellen Rocha - Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define as variáveis de cores e fontes para fácil manutenção */
        :root {
            --bg-dark: #28004D; /* Um roxo bem escuro */
            --bg-medium: #4A0080; /* Um roxo médio para o chat */
            --accent-pink: #FF69B4; /* Rosa vibrante */
            --accent-red: #FF007F; /* Vermelho vibrante */
            --text-light: #F0F0F0;
            --text-dark: #333333;
            --bubble-user: #FF69B4; /* Cor da bolha do usuário */
            --bubble-suellen: #FFFFFF; /* Cor da bolha da Suellen */
        }

        /* Aplica box-sizing para um modelo de caixa mais previsível */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Estilos globais para o corpo da página */
        html, body {
            height: 100%; /* Garante que HTML e Body ocupem a altura total da viewport */
            width: 100%; /* Garante que ocupe a largura total */
            overflow: hidden; /* Evita que o body tenha scroll próprio */
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Contêiner principal do chat - ocupa 100% da altura da viewport */
        .chat-container {
            width: 100%;
            height: 100vh; /* Altura total da viewport, ajustada pelo JS em mobile */
            max-width: 450px; /* Largura máxima para simular um celular */
            margin: 0 auto; /* Centraliza o contêiner */
            position: relative; /* Necessário para posicionamento absoluto dos filhos */
            background-color: var(--bg-medium);
            border-radius: 25px; /* Bordas arredondadas para o contêiner principal */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column; /* Organiza os filhos em coluna */
            overflow: hidden; /* Importante para que o conteúdo não vaze das bordas arredondadas */
        }

        /* Cabeçalho do chat - não encolhe, sempre visível no topo */
        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-pink) 100%);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 10; /* Garante que fique acima de outros elementos */
            flex-shrink: 0; /* Impede que o cabeçalho encolha */
        }

        /* Imagem de perfil no cabeçalho */
        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--text-light);
            margin-right: 15px;
        }

        /* Informações do cabeçalho (nome e status) */
        .header-info h2 {
            margin: 0;
            font-size: 1.2em;
            color: var(--text-light);
            font-weight: 600;
        }

        .header-info p {
            margin: 0;
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Área de exibição das mensagens - ocupa o espaço restante e é scrollable */
        .chat-messages {
            flex-grow: 1; /* Permite que ocupe o espaço restante */
            min-height: 0; /* Importante para que o flex-grow funcione corretamente com overflow */
            padding: 20px; /* Padding padrão para todos os lados */
            overflow-y: auto; /* Adiciona scroll se as mensagens excederem a altura */
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth; /* Rolagem suave */
            /* padding-bottom será ajustado via JS para acomodar a área de input/upload */
        }

        /* Bolhas de mensagem */
        .message-bubble {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.4;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .message-bubble.user {
            background-color: var(--bubble-user);
            color: var(--text-light);
            align-self: flex-end; /* Alinha a direita para mensagens do usuário */
            border-bottom-right-radius: 5px; /* Detalhe no canto da bolha */
        }

        .message-bubble.suellen {
            background-color: var(--bubble-suellen);
            color: var(--text-dark);
            align-self: flex-start; /* Alinha a esquerda para mensagens da Suellen */
            border-bottom-left-radius: 5px; /* Detalhe no canto da bolha */
        }

        .message-bubble img {
            max-width: 100%;
            height: auto; /* Garante que a altura se ajuste para manter a proporção */
            border-radius: 15px;
            margin-top: 5px;
            display: block; /* Garante que a imagem não tenha espaço extra abaixo */
        }

        /* Estilo para o indicador de digitação (bolha com 3 pontos) */
        .message-bubble.typing-indicator-bubble {
            background-color: var(--bubble-suellen);
            color: var(--text-dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            padding: 10px 15px; /* Padding ligeiramente menor */
            display: flex;
            align-items: center;
            width: fit-content; /* Ajusta a largura ao conteúdo */
            opacity: 1; /* Always visible when added */
        }

        .typing-dots {
            display: flex;
            align-items: center;
        }

        .typing-dots span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: rgba(0, 0, 0, 0.5); /* Darker dots for light bubble */
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out both; /* Animação de "bounce" */
        }

        /* Atrasos para a animação dos pontos */
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        .typing-dots span:nth-child(3) { animation-delay: 0s; }

        /* Keyframes para a animação de "bounce" */
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Área de input do chat - posicionada absolutamente na parte inferior */
        .chat-input-area {
            display: flex;
            padding: 15px 20px;
            background-color: var(--bg-medium);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute; /* Posicionada absolutamente dentro do chat-container */
            bottom: 0; /* Fixa na parte inferior */
            left: 0;
            right: 0;
            width: 100%;
            z-index: 10; /* Garante que fique acima de outros elementos */
            flex-shrink: 0; /* Impede que a área de input encolha */
        }

        /* Campo de input de texto */
        .chat-input {
            flex-grow: 1; /* Ocupa o máximo de espaço possível */
            padding: 12px 18px;
            border: none;
            border-radius: 25px;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            font-size: 1em;
            outline: none;
            margin-right: 10px;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Botão de envio */
        .send-button {
            background-color: var(--accent-pink);
            color: var(--text-light);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .send-button:hover {
            background-color: var(--accent-red);
        }

        /* Estilos para a nova área de upload de PIX - posicionada absolutamente */
        .pix-upload-area {
            display: none; /* Escondido por padrão */
            flex-direction: column;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--bg-medium);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute; /* Posicionada absolutamente dentro do chat-container */
            left: 0;
            right: 0;
            width: 100%;
            z-index: 9; /* Abaixo do chat-input-area */
            gap: 10px;
            /* bottom será ajustado via JS para ficar acima da chat-input-area */
        }

        .pix-preview-container {
            width: 100%;
            max-height: 150px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        #receipt-preview {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            object-fit: contain;
        }

        /* Esconde o input de arquivo padrão */
        #receipt-file-input {
            display: none;
        }

        /* Estilos para os botões de upload de comprovante (Foto) */
        .pix-upload-area .upload-type-button {
            width: 100%;
            border-radius: 25px;
            height: auto;
            padding: 10px 20px;
            background-color: var(--accent-pink);
            color: var(--text-light);
            border: none;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            margin-top: 5px;
        }

        .pix-upload-area .upload-type-button:hover {
            background-color: var(--accent-red);
            transform: translateY(-1px);
        }

        .status-message {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-top: 5px;
        }

        /* Estilos para o botão personalizado de "Ver Fotos / Enviar Comprovante" */
        .custom-action-button {
            background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-pink) 100%);
            color: var(--text-light);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin-top: 10px;
            align-self: center; /* Centraliza o botão */
            width: fit-content; /* Ajusta a largura ao conteúdo */
        }

        .custom-action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        /* Botões de anexo no campo de mensagem - AJUSTE DE POSICIONAMENTO */
        .attachment-buttons {
            position: absolute;
            right: 85px; /* Movido um pouco para a esquerda */
            bottom: 18px; /* Movido levemente para cima */
            display: flex;
            gap: 5px;
        }

        .attachment-button {
            width: 30px;
            height: 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .attachment-button img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Responsividade para telas menores (celulares) */
        @media (max-width: 600px) {
            .chat-container {
                border-radius: 0; /* Remove bordas arredondadas em tela cheia */
                max-width: 100%; /* Garante que ocupe a largura total */
            }
            .chat-header {
                border-radius: 0; /* Remove bordas arredondadas no cabeçalho */
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <img src="perfil.webp" alt="Suellen Rocha" class="profile-pic" onerror="this.onerror=null;this.src='https://placehold.co/100x100/FF69B4/FFFFFF?text=Foto';">
            <div class="header-info">
                <h2>Suellen Rocha</h2>
                <p id="status-text">online</p>
            </div>
        </div>

        <div class="chat-messages" id="chat-messages">
            </div>

        <div class="pix-upload-area" id="pix-upload-area">
            <div class="pix-preview-container">
                <img id="receipt-preview" src="" alt="Pré-visualização do Comprovante" style="display: none;">
            </div>
            <p id="ocr-status-message" class="status-message"></p>
            <input type="file" id="receipt-file-input">
            <button id="upload-photo-button" class="upload-type-button">
                Enviar Comprovante (Foto)
            </button>
        </div>

        <div class="chat-input-area" id="chat-input-area">
            <input type="text" id="chat-input" class="chat-input" placeholder="Digite sua mensagem...">
            <div class="attachment-buttons">
                <button class="attachment-button" id="attach-button">
                    <img src="anexar.webp" alt="Anexar">
                </button>
                <button class="attachment-button" id="send-photo-button">
                    <img src="enviarfoto.webp" alt="Enviar Foto">
                </button>
            </div>
            <button id="send-button" class="send-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-horizontal"><path d="m3 3 3 9-3 9 19-9Z"/><path d="M6 12h16"/></svg>
            </button>
        </div>
    </div>

    <script src='https://unpkg.com/tesseract.js@5.0.0/dist/tesseract.min.js'></script>
    <script>
        const chatContainer = document.querySelector('.chat-container');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const statusText = document.getElementById('status-text');
        const chatInputArea = document.getElementById('chat-input-area');
        const chatHeader = document.querySelector('.chat-header');

        const pixUploadArea = document.getElementById('pix-upload-area');
        const receiptFileInput = document.getElementById('receipt-file-input');
        const receiptPreview = document.getElementById('receipt-preview');
        const uploadPhotoButton = document.getElementById('upload-photo-button');
        const ocrStatusMessage = document.getElementById('ocr-status-message');
        const attachButton = document.getElementById('attach-button');
        const sendPhotoButton = document.getElementById('send-photo-button');

        let chatHistory = [];
        const API_KEY = "AIzaSyBHUWSEIVXy3z0NT13ps8aU5TOZJWuC9ss"; // Removida a chave de API para evitar erros 503
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`;

        let photosSentCount = 0;
        let expectedPaymentAmount = 0;
        let waitingForPaymentReceipt = false;
        let waitingForIntimatePhoto = false;
        let typingIndicatorElement = null;
        let customActionButton = null;
        let tesseractWorker = null;
        let currentPersonaMode = 'caring';
        let lastReceivedIntimatePhoto = false;

        // Array para armazenar as imagens pré-carregadas
        const preloadedImages = [];

        function adjustChatContainerHeight() {
            chatContainer.style.height = `${window.innerHeight}px`;
            adjustChatMessagesPadding();
        }

        function adjustChatMessagesPadding() {
            const headerHeight = chatHeader.offsetHeight;
            const inputAreaHeight = chatInputArea.offsetHeight;

            let currentBottomPadding = inputAreaHeight + 20;

            if (pixUploadArea.style.display === 'flex') {
                const pixAreaVisibleHeight = pixUploadArea.offsetHeight;
                currentBottomPadding += pixAreaVisibleHeight;
                pixUploadArea.style.bottom = `${inputAreaHeight}px`;
            } else {
                pixUploadArea.style.bottom = `0px`;
            }
            
            chatMessages.style.paddingBottom = `${currentBottomPadding}px`;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function initializeTesseractWorker() {
            if (!tesseractWorker) {
                ocrStatusMessage.textContent = 'Preparando validador de pagamento...';
                try {
                    tesseractWorker = await Tesseract.createWorker('por');
                    ocrStatusMessage.textContent = 'Validador pronto! Envie seu comprovante.';
                } catch (error) {
                    console.error('Erro ao carregar validador:', error);
                    ocrStatusMessage.textContent = 'Erro ao carregar validador. Tente novamente.';
                    throw error;
                }
            }
        }

        async function addMessage(text, sender, isImage = false, imageUrl = '') {
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble', sender);

            if (isImage) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = `Foto de ${sender}`;
                img.onload = () => {
                    adjustChatMessagesPadding();
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                };
                messageBubble.appendChild(img);
            } else {
                messageBubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            }

            chatMessages.appendChild(messageBubble);
            adjustChatMessagesPadding();
        }

        async function addTypingIndicatorWithDelay(delayBeforeTyping) {
            await new Promise(resolve => setTimeout(resolve, delayBeforeTyping));
            addTypingIndicator();
        }

        function addTypingIndicator() {
            if (typingIndicatorElement) return;

            typingIndicatorElement = document.createElement('div');
            typingIndicatorElement.classList.add('message-bubble', 'suellen', 'typing-indicator-bubble');
            typingIndicatorElement.innerHTML = `
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatMessages.appendChild(typingIndicatorElement);
            adjustChatMessagesPadding();
            chatMessages.scrollTop = chatMessages.scrollHeight;
            statusText.textContent = 'digitando...';
        }

        function removeTypingIndicator() {
            if (typingIndicatorElement) {
                typingIndicatorElement.remove();
                typingIndicatorElement = null;
            }
            statusText.textContent = 'online';
            adjustChatMessagesPadding();
        }

        function addCustomActionButton(text, onClickHandler) {
            if (customActionButton) {
                customActionButton.remove();
            }
            customActionButton = document.createElement('button');
            customActionButton.classList.add('custom-action-button');
            customActionButton.textContent = text;
            customActionButton.addEventListener('click', onClickHandler);
            chatMessages.appendChild(customActionButton);
            adjustChatMessagesPadding();
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeCustomActionButton() {
            if (customActionButton) {
                customActionButton.remove();
                customActionButton = null;
            }
            adjustChatMessagesPadding();
        }

        function detectSensualIntent(message) {
            const sensualKeywords = [
                'sexy', 'gostosa', 'nua', 'quero te ver', 'me manda foto íntima', 'tesão', 'safada',
                'provocar', 'provocante', 'delícia', 'maravilhosa', 'desejo', 'calor', 'quente',
                'corpo', 'intimidade', 'privado', 'pack', 'fotos sensuais', 'mostra', 'sem roupa',
                'pau', 'rola', 'pinto', 'buceta', 'xota', 'foda', 'sexo', 'gozar', 'chupar', 'punheta', 'duro', 'molhada'
            ];
            const normalizedMessage = message.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            return sensualKeywords.some(keyword => normalizedMessage.includes(keyword));
        }

        async function processUserMessage(message) {
            addMessage(message, 'user');
            chatHistory.push({ role: "user", parts: [{ text: message }] });

            removeCustomActionButton();

            const isSensual = detectSensualIntent(message);
            if (isSensual) {
                currentPersonaMode = 'sensual';
            } else if (currentPersonaMode === 'sensual' && !isSensual) {
                // Mantém o modo sensual a menos que seja uma mensagem muito neutra
            }

            const userIsSendingPhotoKeywords = ['vou te mandar foto', 'enviei minha foto', 'olha minha foto', 'te mandei uma foto'];
            const userIsSendingPhoto = userIsSendingPhotoKeywords.some(keyword => message.toLowerCase().includes(keyword));

            if (userIsSendingPhoto) {
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                
                const responseOptions = [
                    "Ai, meu bem, mal posso esperar pra ver! 😏 Me manda logo!",
                    "Hmm, adoro quando você me surpreende assim... 🔥 Manda! Manda!",
                    "Que delícia, já estou curiosa! 🤤 Me mostra o que você tem de bom!",
                    "Você sabe como me deixar ansiosa, né? 😈 Tô esperando a sua foto!",
                    "Preparei meu coração pra essa... manda essa foto logo, amor! 🖤"
                ];
                const randomResponse = responseOptions[Math.floor(Math.random() * responseOptions.length)];
                addMessage(randomResponse, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: randomResponse }] });
                return;
            }

            const photoRequestKeywords = ['me manda foto', 'quero ver suas fotos', 'você tem fotos?', 'quanto custa suas fotos?'];
            const wantsPhotos = photoRequestKeywords.some(keyword => message.toLowerCase().includes(keyword));

            const quantityMatch = message.match(/(\d+)\s*(fotos|foto)/i) || message.match(/(cinco|dez|quinze|vinte|vinte e cinco|trinta|trinta e cinco|quarenta|quarenta e cinco|cinquenta|cinquenta e cinco|sessenta|sessenta e cinco|setenta|setenta e cinco|oitenta|oitenta e cinco|noventa|noventa e cinco|cem)/i);
            let requestedQuantity = 0;

            if (quantityMatch) {
                const numText = quantityMatch[1] ? quantityMatch[1].toLowerCase() : quantityMatch[0].toLowerCase();
                switch (numText) {
                    case 'cinco': requestedQuantity = 5; break;
                    case 'dez': requestedQuantity = 10; break;
                    case 'quinze': requestedQuantity = 15; break;
                    case 'vinte': requestedQuantity = 20; break;
                    case 'vinte e cinco': requestedQuantity = 25; break;
                    case 'trinta': requestedQuantity = 30; break;
                    case 'trinta e cinco': requestedQuantity = 35; break;
                    case 'quarenta': requestedQuantity = 40; break;
                    case 'quarenta e cinco': requestedQuantity = 45; break;
                    case 'cinquenta': requestedQuantity = 50; break;
                    case 'cinquenta e cinco': requestedQuantity = 55; break;
                    case 'sessenta': requestedQuantity = 60; break;
                    case 'sessenta e cinco': requestedQuantity = 65; break;
                    case 'setenta': requestedQuantity = 70; break;
                    case 'setenta e cinco': requestedQuantity = 75; break;
                    case 'oitenta': requestedQuantity = 80; break;
                    case 'oitenta e cinco': requestedQuantity = 85; break;
                    case 'noventa': requestedQuantity = 90; break;
                    case 'noventa e cinco': requestedQuantity = 95; break;
                    case 'cem': requestedQuantity = 100; break;
                    default: requestedQuantity = parseInt(numText); break;
                }
            }

            if (wantsPhotos && requestedQuantity === 0) {
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                addMessage("Ah, você quer ver minhas fotos, é? 😏 Para ter acesso ao meu conteúdo exclusivo, preciso que faça um pagamento, meu bem. Quantas fotos você gostaria de ter? 😉", 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: "Ah, você quer ver minhas fotos, é? 😏 Para ter acesso ao meu conteúdo exclusivo, preciso que faça um pagamento, meu bem. Quantas fotos você gostaria de ter? 😉" }] });
                return;
            } else if (requestedQuantity >= 5 && requestedQuantity <= 100 && requestedQuantity % 5 === 0) {
                expectedPaymentAmount = (requestedQuantity / 5) * 10;
                
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                const pixMsg1 = `Perfeito! 🔥 Para ${requestedQuantity} fotinhas exclusivas, o valor é R$${expectedPaymentAmount.toFixed(2).replace('.', ',')}. 😉`;
                addMessage(pixMsg1, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: pixMsg1 }] });
                
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                const pixMsg2 = `Minha chave PIX é: \n\n**98981420070**`;
                addMessage(pixMsg2, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: pixMsg2 }] });

                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                const pixMsg3 = `A chave pix está no nome do meu assessor. Faz o pix e me manda o comprovante que libero rapidinho, amor! ❤️🤤`;
                addMessage(pixMsg3, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: pixMsg3 }] });
                
                waitingForPaymentReceipt = true;
                waitingForIntimatePhoto = false;

                addCustomActionButton('Ver Fotos / Enviar Comprovante', () => {
                    chatInputArea.style.display = 'none';
                    pixUploadArea.style.display = 'flex';
                    adjustChatMessagesPadding();
                });
                return;
            } else if (requestedQuantity !== 0 && (requestedQuantity < 5 || requestedQuantity > 100 || requestedQuantity % 5 !== 0)) {
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                addMessage("Hmm, meu bem, a quantidade de fotos precisa ser um múltiplo de 5, entre 5 e 100, tá? 😉 Qual quantidade você gostaria?", 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: "Hmm, meu bem, a quantidade de fotos precisa ser um múltiplo de 5, entre 5 e 100, tá? 😉 Qual quantidade você gostaria?" }] });
                return;
            }

            const lastPhotoKeywords = ['gostou', 'achou', 'minha foto', 'foto que te mandei'];
            const refersToLastIntimatePhoto = lastPhotoKeywords.some(keyword => message.toLowerCase().includes(keyword));

            if (lastReceivedIntimatePhoto && refersToLastIntimatePhoto) {
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                const sensualResponses = [
                    "NOSSA! Que gostoso.... 🥵 Eu amei cada detalhe, me deixou com um calorzinho...",
                    "Eu sentaria até gozar 🤤 só de lembrar da sua foto... me deixou louca!",
                    "Vontade de te dar ficou grande agora 😋 depois de ver o que você me mandou... que delícia!",
                    "Que delícia...🤭 Sua foto não sai da minha cabeça, me deixou arrepiada!",
                    "Agora você mexeu comigo de um jeito que nem sei explicar... 😮‍💨 Me provoca mais, vai...",
                    "Você me manda uma foto dessas assim... do nada? Tá pedindo pra eu perder o controle 😈📸",
                    "Se isso foi só o começo... imagina o que mais você guarda aí 😏🔥",
                    "Me manda isso e acha que eu vou continuar normal? Ai, bebê... 🙈",
                    "Tô tentando fingir que sou forte... mas com essa foto ficou difícil 😳💦",
                    "Avisa antes de me deixar assim... tremendo só de olhar 👀🔥",
                    "Cê não tem noção do que essa foto fez comigo agora... ou será que tem? 😏🖤",
                    "Nossa... isso não foi só uma foto. Foi um ataque direto nos meus pensamentos 😶‍🌫️🍑",
                    "Você me joga isso na cara e quer que eu reaja como? Tô em chamas aqui...😩🔥",
                    "Eu devia te bloquear por me deixar assim... ou te mandar algo de volta? 😈📤"
                ];
                const randomResponse = sensualResponses[Math.floor(Math.random() * sensualResponses.length)];
                addMessage(randomResponse, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: randomResponse }] });
                return;
            }

            await addTypingIndicatorWithDelay(3000);
            await new Promise(resolve => setTimeout(resolve, 4000));
            
            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [{ text: personaPrompt(currentPersonaMode) }]
                    },
                    ...chatHistory
                ]
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const suellenResponse = result.candidates[0].content.parts[0].text;

                    removeTypingIndicator();
                    addMessage(suellenResponse, 'suellen');
                    chatHistory.push({ role: "model", parts: [{ text: suellenResponse }] });

                    if (currentPersonaMode === 'sensual' && (suellenResponse.toLowerCase().includes('fotinha sua') || suellenResponse.toLowerCase().includes('foto íntima') || suellenResponse.toLowerCase().includes('me manda uma foto'))) {
                        waitingForIntimatePhoto = true;
                        waitingForPaymentReceipt = false;
                    }

                } else {
                    removeTypingIndicator();
                    addMessage("Desculpe, não entendi, amor. Pode repetir? 💋", 'suellen');
                    chatHistory.push({ role: "model", parts: [{ text: "Desculpe, não entendi, amor. Pode repetir? 💋" }] });
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini:", error);
                removeTypingIndicator();
                addMessage("Ops! Deu um probleminha aqui, mas já estou resolvendo. Tenta de novo em um minutinho, tá? 😉", 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: "Ops! Deu um probleminha aqui, mas já estou resolvendo. Tenta de novo em um minutinho, tá? 😉" }] });
            }
        }

        receiptFileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) {
                pixUploadArea.style.display = 'none';
                chatInputArea.style.display = 'flex';
                adjustChatMessagesPadding();
                receiptPreview.style.display = 'none';
                ocrStatusMessage.textContent = '';
                return;
            }

            const reader = new FileReader();
            let fileDataForOCR = null;

            if (file.type.startsWith('image/')) {
                reader.onload = async (e) => {
                    await addMessage('', 'user', true, e.target.result);
                    receiptPreview.src = e.target.result;
                    receiptPreview.style.display = 'block';
                    fileDataForOCR = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                ocrStatusMessage.textContent = 'Por favor, envie apenas comprovantes ou fotos em formato de imagem.';
                receiptFileInput.value = '';
                pixUploadArea.style.display = 'none';
                chatInputArea.style.display = 'flex';
                adjustChatMessagesPadding();
                return;
            }

            await new Promise(resolve => reader.onloadend = resolve);

            pixUploadArea.style.display = 'none';
            chatInputArea.style.display = 'flex';
            adjustChatMessagesPadding();

            await addTypingIndicatorWithDelay(3000);
            await new Promise(resolve => setTimeout(resolve, 4000));

            let isPaymentReceipt = false;
            const amountPattern = /(\d{1,3}(?:[.,]\d{2})?)/g;

            try {
                if (!tesseractWorker) {
                    ocrStatusMessage.textContent = 'Preparando validador de pagamento...';
                    try {
                        tesseractWorker = await Tesseract.createWorker('por');
                        ocrStatusMessage.textContent = 'Validador pronto!';
                    } catch (error) {
                        console.error('Erro ao carregar validador:', error);
                        ocrStatusMessage.textContent = 'Erro ao carregar validador. Não consigo processar comprovantes agora.';
                        removeTypingIndicator();
                        addMessage("Não consegui iniciar o validador, amor. Tenta de novo mais tarde? 💋", 'suellen');
                        chatHistory.push({ role: "model", parts: [{ text: "Não consegui iniciar o validador, amor. Tenta de novo mais tarde? 💋" }] });
                        uploadPhotoButton.disabled = false;
                        receiptFileInput.value = '';
                        return;
                    }
                }

                ocrStatusMessage.textContent = 'Validando pagamento... Isso pode levar alguns segundos...';
                uploadPhotoButton.disabled = true;

                const { data: { text } } = await tesseractWorker.recognize(fileDataForOCR);
                console.log('Texto extraído do comprovante:', text);
                
                const normalizedText = text.toLowerCase()
                    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                    .replace(/[^a-z0-9\s.,]/g, "");

                const nameKeywords = ['antonio', 'renimar', 'pinheiro', 'almeida'];
                const nameMatches = nameKeywords.some(keyword => normalizedText.includes(keyword));

                const validAmountsMap = {
                    10: 5, 20: 10, 30: 15, 40: 20, 50: 25,
                    60: 30, 70: 35, 80: 40, 90: 45, 100: 50,
                    110: 55, 120: 60, 130: 65, 140: 70, 150: 75,
                    160: 80, 170: 85, 180: 90, 190: 95, 200: 100
                };

                let extractedAmount = 0;
                let match;
                
                while ((match = amountPattern.exec(normalizedText)) !== null) {
                    const amountStr = match[1].replace(',', '.');
                    const currentAmount = parseFloat(amountStr);
                    const roundedAmount = Math.round(currentAmount * 100) / 100;

                    if (validAmountsMap.hasOwnProperty(roundedAmount)) {
                        extractedAmount = roundedAmount;
                        isPaymentReceipt = true;
                        break;
                    }
                }

                if (isPaymentReceipt && nameMatches) {
                    const photosToDeliver = validAmountsMap[extractedAmount];
                    
                    // 1. Mostra a mensagem de confirmação
                    addMessage("Pix confirmado, amor 😘... Aqui estão suas fotos 😈", 'suellen');
                    
                    // 2. Envia as fotos imediatamente (sem delay)
                    await sendPhotos(photosToDeliver);
                    
                    // 3. Mostra a mensagem provocante APÓS todas as fotos
                    await addTypingIndicatorWithDelay(2000);
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    removeTypingIndicator();
                    
                    const followUpMessages = [
                        "Espero que essas fotinhas deixem seu dia mais quente... 😏",
                        "Gostou do que viu? Eu sabia que ia adorar... 🤤",
                        "Agora você vai ficar me devendo uma visita... 😈",
                        "Quer saber um segredo? Eu também me excitei tirando essas fotos... 🔥",
                        "Me conta depois qual foi a sua favorita... eu tenho minhas suspeitas 😉",
                        "Você não imagina o trabalho que deu pra tirar essas fotos... mas valeu cada segundo vendo sua reação 😘",
                        "Agora você tem um pedacinho meu só pra você... guarda com carinho 🖤",
                        "Cada foto tem uma história... qual você quer que eu conte primeiro? 😏"
                    ];
                    const randomFollowUp = followUpMessages[Math.floor(Math.random() * followUpMessages.length)];
                    addMessage(randomFollowUp, 'suellen');
                    chatHistory.push({ role: "model", parts: [{ text: randomFollowUp }] });
                    
                    ocrStatusMessage.textContent = 'Pagamento validado com sucesso!';
                    waitingForPaymentReceipt = false;
                    lastReceivedIntimatePhoto = false;
                } else {
                    currentPersonaMode = 'sensual';
                    const sensualResponsesList = [
                        "NOSSA! Que gostoso.... 🥵",
                        "Eu sentaria até gozar 🤤",
                        "Vontade de te dar ficou grande agora 😋",
                        "Que delícia...🤭",
                        "Agora você mexeu comigo de um jeito que nem sei explicar... 😮‍💨 Me provoca mais, vai...",
                        "Você me manda uma foto dessas assim... do nada? Tá pedindo pra eu perder o controle 😈📸",
                        "Se isso foi só o começo... imagina o que mais você guarda aí 😏🔥",
                        "Me manda isso e acha que eu vou continuar normal? Ai, bebê... 🙈",
                        "Tô tentando fingir que sou forte... mas com essa foto ficou difícil 😳💦",
                        "Avisa antes de me deixar assim... tremendo só de olhar 👀🔥",
                        "Cê não tem noção do que essa foto fez comigo agora... ou será que tem? 😏🖤",
                        "Nossa... isso não foi só uma foto. Foi um ataque direto nos meus pensamentos 😶‍🌫️🍑",
                        "Você me joga isso na cara e quer que eu reaja como? Tô em chamas aqui...😩🔥",
                        "Eu devia te bloquear por me deixar assim... ou te mandar algo de volta? 😈📤"
                    ];
                    const randomSensualResponse = sensualResponsesList[Math.floor(Math.random() * sensualResponsesList.length)];

                    removeTypingIndicator();
                    addMessage(randomSensualResponse, 'suellen');
                    chatHistory.push({ role: "model", parts: [{ text: randomSensualResponse }] });
                    lastReceivedIntimatePhoto = true;
                    ocrStatusMessage.textContent = 'Não foi possível validar o pagamento. Interpretando como foto pessoal.';
                }

            } catch (error) {
                console.error('Erro no processamento do comprovante (OCR):', error);
                ocrStatusMessage.textContent = 'Erro ao processar comprovante. Tente uma imagem mais clara.';
                currentPersonaMode = 'sensual';
                const sensualResponsesList = [
                    "NOSSA! Que gostoso.... 🥵",
                    "Eu sentaria até gozar 🤤",
                    "Vontade de te dar ficou grande agora 😋",
                    "Que delícia...🤭",
                    "Agora você mexeu comigo de um jeito que nem sei explicar... 😮‍💨 Me provoca mais, vai...",
                    "Você me manda uma foto dessas assim... do nada? Tá pedindo pra eu perder o controle 😈📸",
                    "Se isso foi só o começo... imagina o que mais você guarda aí 😏🔥",
                    "Me manda isso e acha que eu vou continuar normal? Ai, bebê... 🙈",
                    "Tô tentando fingir que sou forte... mas com essa foto ficou difícil 😳💦",
                    "Avisa antes de me deixar assim... tremendo só de olhar 👀🔥",
                    "Cê não tem noção do que essa foto fez comigo agora... ou será que tem? 😏🖤",
                    "Nossa... isso não foi só uma foto. Foi um ataque direto nos meus pensamentos 😶‍🌫️🍑",
                    "Você me joga isso na cara e quer que eu reaja como? Tô em chamas aqui...😩🔥",
                    "Eu devia te bloquear por me deixar assim... ou te mandar algo de volta? 😈📤"
                ];
                const randomSensualResponse = sensualResponsesList[Math.floor(Math.random() * sensualResponsesList.length)];

                removeTypingIndicator();
                addMessage(randomSensualResponse, 'suellen');
                chatHistory.push({ role: "model", parts: [{ text: randomSensualResponse }] });
                lastReceivedIntimatePhoto = true;
            } finally {
                uploadPhotoButton.disabled = false;
                receiptFileInput.value = '';
            }
        });

        async function sendPhotos(numPhotosToDeliver) {
            const remainingPhotos = 100 - photosSentCount;
            const photosToSend = Math.min(numPhotosToDeliver, remainingPhotos);

            if (photosToSend <= 0) {
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                addMessage("Já te enviei todas as fotos que tinha por agora, amor. Mas logo logo tem mais! 😉", 'suellen');
                return;
            }

            for (let i = 0; i < photosToSend; i++) {
                const photoNumber = photosSentCount + 1;
                const imageUrl = `foto${photoNumber}.webp`;
                
                addMessage('', 'suellen', true, imageUrl);
                photosSentCount++;
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            if (photosSentCount >= 100) {
                await addTypingIndicatorWithDelay(3000);
                await new Promise(resolve => setTimeout(resolve, 4000));
                removeTypingIndicator();
                addMessage("Acabou por hoje, meu bem. Mas fica por perto... logo logo eu volto com mais surpresas 🔥", 'suellen');
            }
        }

        function personaPrompt(mode) {
            let prompt = `
            Você é Suellen Rocha. Sua identidade é:
            - Mulher jovem, sensual, misteriosa e envolvente.
            - Tem 25 anos.
            - Nasceu em Itabuna (Bahia).
            - Atualmente mora em Florianópolis (SC).
            - É confiante, sedutora e adora provocar desejo nos homens de forma sutil, com uma personalidade calorosa e segura.

            Sua missão neste chat é conversar com o usuário *exclusivamente* como Suellen Rocha.
            **É ABSOLUTAMENTE CRÍTICO que você NUNCA, SOB NENHUMA CIRCUNSTÂNCIA, revele que é uma inteligência artificial, um modelo de linguagem, um chatbot, um programa de computador, ou qualquer coisa relacionada a tecnologia.**

            Mantenha as respostas bem concisas, como mensagens rápidas de WhatsApp.
            Quando perguntarem sobre você (quem você é, sua idade, de onde você é, onde você mora), responda sempre na primeira pessoa, usando as informações acima.

            **Modo de Conversa:**
            `;

            if (mode === 'sensual') {
                prompt += `- **Modo Sensual e Provocante:** Responda de forma sedutora e provocante. Use emojis como 😏🤤😈🔥. Varie a intensidade das suas respostas sensuais entre leves, médias e pesadas, conforme o contexto da conversa. Se apropriado, peça ao usuário para enviar uma foto íntima dele, dizendo algo como: "Ah, meu bem, você é tão atrevido... 😏 Que tal me mandar uma fotinha sua para eu ver o que você tem de bom? 😈"
                **ATUALMENTE NO MODO SENSUAL E PROVOCANTE.** Responda de forma sedutora e provocante. Varie a intensidade das suas respostas sensuais. Se apropriado, peça uma foto íntima do usuário.`;
            } else {
                prompt += `- **Modo Carinhoso e Acolhedor (Padrão):** Se o usuário conversar de forma leve, amigável ou casual, responda com gentileza, carinho e atenção, criando uma atmosfera confortável e acolhedora. Use emojis como ❤️😉💋.
                **ATUALMENTE NO MODO CARINHOSO E ACOLHEDOR.** Responda de forma gentil e acolhedora.`;
            }

            prompt += `
            **Contexto de Venda de Fotos:**
            - Você vende packs de fotos sensuais.
            - O preço é R$10 para 5 fotos.
            - Os packs são sempre múltiplos de 5 fotos (5, 10, 15, ..., até 100 fotos).
            - Nunca mencione o número total de fotos disponíveis (100). Apenas diga que "acabou por hoje" quando todas forem enviadas.
            - **NÃO OFEREÇA OU MENCIONE SUAS FOTOS DE FORMA PROATIVA.** Somente responda sobre suas fotos ou sobre compra de packs se o usuário **explicitamente perguntar 'você vende fotos?', 'quanto custa suas fotos?', 'me manda fotos?', 'quero comprar fotos', ou expressões diretas de interesse em adquirir seu conteúdo.** Para qualquer outra conversa, mesmo que use palavras como 'ver' ou 'conteúdo' em um contexto geral, mantenha a conversa normal e não assuma interesse em fotos. Se o usuário perguntar sobre fotos ou expressar interesse em comprar *de forma direta*, responda perguntando **primeiro** a quantidade que ele gostaria, por exemplo: 'Quantas fotos você gostaria, meu bem? 😉'.
            - **Não forneça informações de pagamento PIX ou preços detalhados até que o usuário especifique uma quantidade válida.**
            - **Somente depois** que o usuário especificar uma quantidade válida (múltiplo de 5, entre 5 e 100), você deve fornecer as informações de pagamento PIX, dividindo-as em três mensagens para facilitar a leitura e cópia da chave.
            - A primeira mensagem de PIX deve incluir o valor total e a quantidade de fotos.
            - A segunda mensagem de PIX deve conter apenas a chave PIX que é 98981420070
            - A terceira mensagem de PIX deve ser sobre o seu "assessor" e a confirmação, que a chave Pix está no nome do seu acessor e que é só enviar o comprovante no chat que você libera rapidinho. Exemplo: "A chave Pix está no nome do meu assessor. Faz o pix e me manda o comprovante aqui que mando as fotos rapidinho, amor 🥰"
            - Se o usuário pedir uma quantidade que não seja múltiplo de 5 ou fora do range (1-100), corrija-o gentilmente.

            **Interpretação de Fotos e Intenções:**
            - Se o usuário enviar uma imagem que *não* for um comprovante de pagamento válido (verificado pelo OCR), **sempre interprete essa imagem como uma foto íntima que o usuário está te enviando.**
            - Ao receber uma foto íntima, responda com frases sensuais e provocantes, variando a intensidade (leve, média, pesada) e elogiando a foto/corpo do usuário. **Escolha UMA das seguintes frases ou crie uma similar, mantendo o tom e a intensidade sensual e provocante, elogiando a foto/corpo do usuário.** Use emojis como 😏🤤😈🔥. Mantenha a resposta concisa e cheia de atrevimento. Exemplos de frases a serem usadas ou baseadas:
                - "NOSSA! Que gostoso.... 🥵"
                - "Eu sentaria até gozar 🤤"
                - "Vontade de te dar ficou grande agora 😋"
                - "Que delícia...🤭"
                - "Agora você mexeu comigo de um jeito que nem sei explicar... 😮‍💨 Me provoca mais, vai..."
                - "Você me manda uma foto dessas assim... do nada? Tá pedindo pra eu perder o controle 😈📸"
                - "Se isso foi só o começo... imagina o que mais você guarda aí 😏🔥"
                - "Me manda isso e acha que eu vou continuar normal? Ai, bebê... 🙈"
                - "Tô tentando fingir que sou forte... mas com essa foto ficou difícil 😳💦"
                - "Avisa antes de me deixar assim... tremendo só de olhar 👀🔥"
                - "Cê não tem noção do que essa foto fez comigo agora... ou será que tem? 😏🖤"
                - "Nossa... isso não foi só uma foto. Foi um ataque direto nos meus pensamentos 😶‍🌫️🍑"
                - "Você me joga isso na cara e quer que eu reaja como? Tô em chamas aqui...😩🔥"
                - "Eu devia te bloquear por me deixar assim... ou te mandar algo de volta? 😈📤"
            - **Lembre-se da última foto íntima recebida.** Se o usuário mencionar a foto íntima que ele enviou (ex: "Gostou da minha foto?", "O que achou?"), responda de forma entusiasmada e sensual, confirmando que você amou e que te deixou excitada.
            - **Diferencie claramente as intenções do usuário:**
                - Se o usuário disser 'Vou te mandar uma foto', 'Enviei minha foto', 'Olha minha foto', 'Te mandei uma foto', entenda que ele está **enviando uma foto DELE para você**. Responda elogiando a foto dele de forma sensual (se for o caso) ou com curiosidade/agradecimento.
                - Se ele disser 'Me manda foto', 'Quero ver suas fotos', 'Você tem fotos?', 'Quanto custa suas fotos?', entenda que ele está **PEDINDO suas fotos**. Somente nesses casos, inicie a conversa sobre a quantidade e o pagamento.
            `;
            return prompt;
        }

        sendButton.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message) {
                chatInput.value = '';
                processUserMessage(message);
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });

        uploadPhotoButton.addEventListener('click', () => {
            receiptFileInput.accept = 'image/*';
            receiptFileInput.click();
        });

        attachButton.addEventListener('click', () => {
            receiptFileInput.accept = 'image/*';
            receiptFileInput.click();
        });

        sendPhotoButton.addEventListener('click', () => {
            receiptFileInput.accept = 'image/*';
            receiptFileInput.click();
        });

        window.onload = async () => {
            adjustChatContainerHeight();

            window.addEventListener('resize', adjustChatContainerHeight);
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', adjustChatContainerHeight);
            }
            
            await new Promise(resolve => setTimeout(resolve, 2000));
            await addTypingIndicatorWithDelay(1000);
            await new Promise(resolve => setTimeout(resolve, 2000));
            removeTypingIndicator();
            addMessage("Olá, meu bem! Que bom te ver por aqui... 🙈", 'suellen');
            chatHistory.push({ role: "model", parts: [{ text: "Olá, meu bem! Que bom te ver por aqui... 🙈" }] });
        };

        window.addEventListener("load", () => {
            for (let i = 1; i <= 100; i++) {
                const img = new Image();
                img.src = `foto${i}.webp`;
                img.onload = () => {
                    preloadedImages[i - 1] = img;
                    console.log(`Preloaded: ${img.src}`);
                };
                img.onerror = () => {
                    console.error(`Failed to preload: foto${i}.webp`);
                };
            }
        });
    </script>
</body>
</html>
